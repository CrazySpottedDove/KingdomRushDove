local i18n = require("i18n")
require("constants")
local anchor_x = 0
local anchor_y = 0
local image_x = 0
local image_y = 0
local tt = nil
local scripts = require("game_scripts")
require("templates")
local function adx(v)
    return v - anchor_x * image_x
end
local function ady(v)
    return v - anchor_y * image_y
end
require("game_templates_utils")
local function boss()
    -- 毁灭者
    tt = RT("eb_juggernaut", "boss")
    AC(tt, "melee", "timed_attacks")
    anchor_y = 0.08
    anchor_x = 0.5
    image_y = 128
    image_x = 144
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.dead_lifetime = 10
    tt.health.hp_max = 10000
    tt.health.armor = 0.6
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.health_bar.offset = vec_2(0, ady(120))
    tt.info.i18n_key = "EB_JUGGERNAUT"
    tt.info.enc_icon = 32
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0027" or "info_portraits_sc_0027"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_juggernaut.update
    tt.motion.max_speed = 0.4 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.08)
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.render.sprites[1].prefix = "eb_juggernaut"
    tt.sound_events.death = "DeathJuggernaut"
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect = r(-35, 0, 70, 80)
    tt.unit.blood_color = BLOOD_GRAY
    tt.unit.hit_offset = vec_2(0, ady(50))
    tt.unit.mod_offset = vec_2(adx(70), ady(50))
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 175
    tt.melee.attacks[1].damage_min = 100
    tt.melee.attacks[1].damage_radius = 45
    tt.melee.attacks[1].count = 10
    tt.melee.attacks[1].hit_time = fts(15)
    tt.melee.attacks[1].hit_offset = tt.enemy.melee_slot
    tt.melee.attacks[1].hit_fx = "fx_juggernaut_smoke"
    tt.melee.attacks[1].sound_hit = "juggernaut_punch"
    tt.timed_attacks.list[1] = E:clone_c("custom_attack")
    tt.timed_attacks.list[1].animation = "shoot"
    tt.timed_attacks.list[1].bullet = "missile_juggernaut"
    tt.timed_attacks.list[1].bullet_start_offset = vec_2(-30, 82)
    tt.timed_attacks.list[1].cooldown = 11
    tt.timed_attacks.list[1].launch_vector = vec_2(12, 170)
    tt.timed_attacks.list[1].max_range = 99999
    tt.timed_attacks.list[1].min_range = 100
    tt.timed_attacks.list[1].shoot_time = fts(24)
    tt.timed_attacks.list[1].vis_flags = F_RANGED
    tt.timed_attacks.list[2] = table.deepclone(tt.timed_attacks.list[1])
    tt.timed_attacks.list[2].bullet = "bomb_juggernaut"
    tt.timed_attacks.list[2].cooldown = 4

    tt = RT("bomb_juggernaut", "bomb")
    tt.bullet.damage_bans = F_ALL
    tt.bullet.damage_flags = 0
    tt.bullet.damage_max = 0
    tt.bullet.damage_min = 0
    tt.bullet.damage_radius = 1
    tt.bullet.flight_time_base = fts(45)
    tt.bullet.flight_time_factor = fts(0.025)
    tt.bullet.pop = nil
    tt.bullet.hit_payload = "juggernaut_bomb_spawner"
    tt.main_script.insert = scripts.enemy_bomb.insert
    tt.main_script.update = scripts.enemy_bomb.update
    tt.bullet.hit_fx = nil
    tt.render.sprites[1].name = "bossJuggernaut_bomb_"
    tt.sound_events.hit = "BombExplosionSound"

    tt = RT("juggernaut_bomb_spawner", "decal_scripted")
    E:add_comps(tt, "render", "spawner", "tween")
    tt.main_script.update = scripts.enemies_spawner.update
    tt.render.sprites[1].anchor.y = 0.22
    tt.render.sprites[1].prefix = "bomb_juggernaut_spawner"
    tt.render.sprites[1].loop = false
    tt.spawner.animation_concurrent = "open"
    tt.spawner.count = 5
    tt.spawner.count_inc = 1
    tt.spawner.cycle_time = fts(6)
    tt.spawner.entity = "enemy_golem_head"
    tt.spawner.keep_gold = true
    tt.spawner.node_offset = 2
    tt.spawner.pos_offset = vec_2(0, 0)
    tt.spawner.allowed_subpaths = {1, 2, 3}
    tt.spawner.random_subpath = false
    tt.tween.disabled = true
    tt.tween.props[1].keys = {{0, 255}, {4, 0}}
    tt.tween.remove = true
    tt.total_gold = 70

    tt = RT("enemy_golem_head", "enemy")
    AC(tt, "melee")
    anchor_y = 0.20588235294117646
    anchor_x = 0.5
    image_y = 34
    image_x = 40
    tt.enemy.gold = 10
    tt.enemy.melee_slot = vec_2(20, 0)
    tt.health.hp_max = 90
    tt.health.armor = 0.6
    tt.health_bar.offset = vec_2(0, 23)
    tt.info.i18n_key = "ENEMY_GOLEM_HEAD"
    tt.info.enc_icon = 15
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0028" or "info_portraits_sc_0028"
    tt.melee.attacks[1].cooldown = 1 + fts(20)
    tt.melee.attacks[1].damage_max = 20
    tt.melee.attacks[1].damage_min = 10
    tt.melee.attacks[1].hit_time = fts(8)
    tt.motion.max_speed = 0.7 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "enemy_golem_head"
    tt.sound_events.death = "DeathPuff"
    tt.unit.blood_color = BLOOD_GRAY
    tt.unit.can_explode = false
    tt.unit.hide_after_death = true
    tt.unit.hit_offset = vec_2(0, 8)
    tt.unit.mod_offset = vec_2(adx(22), ady(15))
    tt.unit.show_blood_pool = false

    tt = RT("missile_juggernaut", "bullet")
    tt.bullet.acceleration_factor = 0.1
    tt.bullet.damage_bans = bor(F_ENEMY, F_BOSS)
    tt.bullet.damage_flags = F_AREA
    tt.bullet.damage_max = 250
    tt.bullet.damage_min = 150
    tt.bullet.damage_radius = 41.25
    tt.bullet.damage_type = DAMAGE_PHYSICAL
    tt.bullet.hit_fx = "fx_explosion_air"
    tt.bullet.hit_fx_air = "fx_explosion_air"
    tt.bullet.max_speed = 450
    tt.bullet.min_speed = 300
    tt.bullet.particles_name = "ps_missile"
    tt.bullet.retarget_range = 99999
    tt.bullet.rot_dir_from_long_angle = true
    tt.bullet.turn_speed = 10 * math.pi / 180 * 30
    tt.bullet.vis_bans = bor(F_ENEMY)
    tt.bullet.vis_flags = F_RANGED
    tt.main_script.update = scripts.enemy_missile.update
    tt.render.sprites[1].prefix = "missile_bfg"
    tt.render.sprites[1].name = "flying"
    tt.sound_events.insert = "RocketLaunchSound"
    tt.sound_events.hit = "BombExplosionSound"

    -- 大雪怪
    tt = RT("eb_jt", "boss")
    AC(tt, "melee", "timed_attacks", "auras")
    anchor_y = 0.19
    anchor_x = 0.5
    image_y = 200
    image_x = 260
    tt.auras.list[1] = E:clone_c("aura_attack")
    tt.auras.list[1].name = "jt_spawner_aura"
    tt.auras.list[1].cooldown = 0
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(55, 0)
    tt.health.dead_lifetime = 100
    tt.health.hp_max = 12000
    tt.health.on_damage = scripts.eb_jt.on_damage
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.health_bar.offset = vec_2(0, ady(172))
    tt.info.fn = scripts.eb_jt.get_info
    tt.info.i18n_key = "EB_JT"
    tt.info.enc_icon = 33
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0047" or "info_portraits_sc_0047"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_jt.update
    tt.motion.max_speed = 0.3 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.08)
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.render.sprites[1].prefix = "eb_jt"
    tt.tap_decal = "decal_jt_tap"
    tt.tap_timeout = 1.5
    tt.sound_events.death = "JtDeath"
    tt.sound_events.death_explode = "JtExplode"
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect = r(-38, 0, 76, 95)
    tt.unit.hit_offset = vec_2(0, 60)
    tt.unit.marker_hidden = true
    tt.unit.mod_offset = vec_2(adx(130), ady(90))
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].count = 5
    tt.melee.attacks[1].damage_max = 200
    tt.melee.attacks[1].damage_min = 150
    tt.melee.attacks[1].damage_radius = 45
    tt.melee.attacks[1].damage_type = DAMAGE_EAT
    tt.melee.attacks[1].hit_offset = tt.enemy.melee_slot
    tt.melee.attacks[1].hit_time = fts(15)
    tt.melee.attacks[1].sound = "JtEat"
    tt.melee.attacks[1].sound_args = {
        delay = fts(6)
    }
    tt.melee.attacks[1].side_effect = function(this, store, attack, target)
        scripts.heal(this, 100)
    end
    tt.timed_attacks.list[1] = CC("custom_attack")
    tt.timed_attacks.list[1].cooldown = 10 + fts(29)
    tt.timed_attacks.list[1].count = 4
    tt.timed_attacks.list[1].exhausted_duration = 2
    tt.timed_attacks.list[1].exhausted_sound = "JtRest"
    tt.timed_attacks.list[1].exhausted_sound_args = {
        delay = fts(34)
    }
    tt.timed_attacks.list[1].hit_decal = "decal_jt_ground_hit"
    tt.timed_attacks.list[1].hit_offset = vec_2(80, -10)
    tt.timed_attacks.list[1].hit_time = fts(16)
    tt.timed_attacks.list[1].max_range = 192
    tt.timed_attacks.list[1].min_range = 0
    tt.timed_attacks.list[1].mod = "mod_jt_tower"
    tt.timed_attacks.list[1].sound = "JtAttack"
    tt.timed_attacks.list[1].sound_args = {
        delay = fts(6)
    }

    -- 卫兹南
    tt = RT("eb_veznan", "boss")
    AC(tt, "melee", "timed_attacks", "taunts")
    anchor_y = 0.17010309278350516
    anchor_x = 0.5
    image_y = 194
    image_x = 214
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(20, 0)
    tt.health.hp_max = {6666, 7999, 9666, 11666}
    tt.health.on_damage = scripts.eb_veznan.on_damage
    tt.health.ignore_damage = true
    tt.health_bar.hidden = true
    tt.health_bar.offset = vec_2(0, 43)
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM_MEDIUM
    tt.health.magic_armor = 0.4
    tt.info.i18n_key = "EB_VEZNAN"
    tt.info.enc_icon = 34
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0056" or "info_portraits_sc_0056"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_veznan.update
    tt.motion.max_speed = 0.35 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_veznan"
    tt.render.sprites[1].name = "idleDown"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "VeznanDeath"
    tt.ui.click_rect = r(-11, -2, 22, 38)
    tt.unit.hit_offset = vec_2(0, 14)
    tt.unit.mod_offset = vec_2(0, 12)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH, F_ALL)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.pos_castle = vec_2(518, 677)
    tt.souls_aura = "veznan_souls_aura"
    tt.white_circle = "decal_eb_veznan_white_circle"
    tt.taunts.animation = "laught"
    tt.taunts.delay_min = fts(400)
    tt.taunts.delay_max = fts(700)
    tt.taunts.duration = 4
    tt.taunts.decal_name = "decal_s12_shoutbox"
    tt.taunts.offset = vec_2(0, 0)
    tt.taunts.pos = vec_2(525, 608)
    tt.taunts.sets.welcome = CC("taunt_set")
    tt.taunts.sets.welcome.format = "VEZNAN_TAUNT_%04d"
    tt.taunts.sets.welcome.end_idx = 5
    tt.taunts.sets.welcome.delays = {fts(60), fts(140), fts(450), fts(250)}
    tt.taunts.sets.castle = CC("taunt_set")
    tt.taunts.sets.castle.format = "VEZNAN_TAUNT_%04d"
    tt.taunts.sets.castle.start_idx = 6
    tt.taunts.sets.castle.end_idx = 25
    tt.taunts.sets.damage = CC("taunt_set")
    tt.taunts.sets.damage.format = "VEZNAN_TAUNT_%04d"
    tt.taunts.sets.damage.start_idx = 26
    tt.taunts.sets.damage.end_idx = 29
    tt.taunts.sets.pre_battle = CC("taunt_set")
    tt.taunts.sets.pre_battle.format = "VEZNAN_TAUNT_%04d"
    tt.taunts.sets.pre_battle.start_idx = 30
    tt.taunts.sets.pre_battle.end_idx = 30
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].count = 8
    tt.melee.attacks[1].damage_min = 666
    tt.melee.attacks[1].damage_max = 999
    tt.melee.attacks[1].damage_radius = 75
    tt.melee.attacks[1].damage_type = DAMAGE_MAGICAL
    tt.melee.attacks[1].hit_offset = vec_2(-10, -2)
    tt.melee.attacks[1].hit_time = fts(17)
    tt.melee.attacks[1].hit_decal = "decal_veznan_strike"
    tt.melee.attacks[1].sound_hit = "VeznanAttack"
    tt.melee.attacks[2] = table.deepclone(tt.melee.attacks[1])
    tt.melee.attacks[2].cooldown = 2.5
    tt.melee.attacks[2].damage_type = DAMAGE_PHYSICAL
    tt.melee.attacks[2].disabled = true
    tt.melee.attacks[2].hit_decal = nil
    tt.melee.attacks[2].hit_fx = "fx_veznan_demon_fire"
    tt.melee.attacks[2].hit_fx_offset = vec_2(20, 9)
    tt.melee.attacks[2].hit_fx_once = true
    tt.melee.attacks[2].hit_fx_flip = true
    tt.melee.attacks[2].hit_times = {fts(20), fts(24), fts(28), fts(32), fts(36), fts(38), fts(42), fts(44)}
    tt.melee.attacks[2].hit_offset = vec_2(40, 0)
    tt.melee.attacks[2].sound_hit = nil
    tt.melee.attacks[2].sound = "VeznanDemonFire"
    tt.timed_attacks.list[1] = CC("custom_attack")
    tt.timed_attacks.list[1].cooldown = 13
    tt.timed_attacks.list[1].animation = "spellDown"
    tt.timed_attacks.list[1].hit_time = fts(14)
    tt.timed_attacks.list[1].mod = "mod_veznan_tower"
    tt.timed_attacks.list[1].sound = "VeznanHoldCast"
    tt.timed_attacks.list[1].attack_duration = fts(44)
    tt.timed_attacks.list[1].data = {
        [9] = {13, 2},
        [10] = {13, 3},
        [11] = {14, 4},
        [12] = {14, 5},
        [13] = {16, 6},
        [14] = {16, 7},
        [15] = {18, 8}
    }
    tt.timed_attacks.list[2] = CC("custom_attack")
    tt.timed_attacks.list[2].animation = "spellDown"
    tt.timed_attacks.list[2].cooldown = 15
    tt.timed_attacks.list[2].hit_time = fts(14)
    tt.timed_attacks.list[2].portal_name = "veznan_portal"
    tt.timed_attacks.list[2].sound = "VeznanPortalSummon"
    tt.timed_attacks.list[2].attack_duration = fts(44)
    tt.timed_attacks.list[2].data = {
        [6] = {15, 3, {1, 0, 0}},
        [7] = {10, 2, {1, 0, 0}},
        [8] = {20, 3, {0, 1, 0}},
        [9] = {15, 3, {1, 0, 0}},
        [10] = {20, 3, {1, 1, 0}},
        [11] = {15, 3, {1, 1, 0}},
        [12] = {15, 3, {1, 1, 0}},
        [13] = {15, 3, {0, 0, 1}},
        [14] = {15, 3, {1, 1, 1}},
        [15] = {15, 3, {1, 1, 1}}
    }
    tt.battle = {
        ba_animation = "spell",
        pa_animation = "spell",
        pa_cooldown = 10,
        pa_max_count = 40
    }
    tt.demon = {
        health_bar_offset = vec_2(0, 118),
        health_bar_scale = 1.8,
        melee_slot = vec_2(50, 0),
        speed = 0.6 * FPS,
        sprites_prefix = "eb_veznan_demon",
        transform_sound = "VeznanToDemon",
        ui_click_rect = r(-25, -5, 50, 110),
        unit_hit_offset = vec_2(0, 55),
        unit_mod_offset = vec_2(0, 45),
        unit_size = UNIT_SIZE_LARGE,
        info_portrait = IS_PHONE_OR_TABLET and "portraits_sc_0056" or "info_portraits_sc_0093"
    }

    -- 萨雷格兹
    tt = RT("eb_sarelgaz", "boss")
    AC(tt, "melee", "timed_attacks")
    anchor_y = 0.1484375
    anchor_x = 0.5
    image_y = 128
    image_x = 220
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(80, 0)
    tt.health.dead_lifetime = 8
    tt.health.hp_max = 17000
    tt.health.magic_armor = 0.4
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.health_bar.offset = vec_2(0, 108)
    tt.info.i18n_key = "EB_SARELGAZ"
    tt.info.enc_icon = 35
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0057" or "info_portraits_sc_0057"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.enemy_spider_big.update
    tt.melee.attacks[1].cooldown = 1
    tt.melee.attacks[1].damage_max = 500
    tt.melee.attacks[1].damage_min = 300
    tt.melee.attacks[1].hit_time = fts(15)
    tt.melee.attacks[1].damage_type = DAMAGE_EAT
    tt.melee.attacks[1].sound = "SpiderAttack"
    tt.timed_attacks.list[1] = E:clone_c("bullet_attack")
    tt.timed_attacks.list[1].bullet = "enemy_sarelgaz_egg"
    tt.timed_attacks.list[1].max_cooldown = 12
    tt.timed_attacks.list[1].max_count = 100
    tt.timed_attacks.list[1].min_cooldown = 10
    tt.motion.max_speed = 0.34 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_sarelgaz"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "DeathEplosion"
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect = r(-45, 0, 90, 80)
    tt.unit.blood_color = BLOOD_GREEN
    tt.unit.can_explode = false
    tt.unit.can_disintegrate = false
    tt.unit.fade_time_after_death = 2
    tt.unit.hit_offset = vec_2(0, 45)
    tt.unit.marker_hidden = true
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 45)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.health_judger = true

    tt = E:register_t("enemy_sarelgaz_egg", "decal_scripted")
    E:add_comps(tt, "render", "spawner", "tween")
    tt.main_script.update = scripts.enemies_spawner.update
    tt.render.sprites[1].anchor.y = 0.22
    tt.render.sprites[1].scale = vec_2(2, 2)
    tt.render.sprites[1].prefix = "enemy_spider_egg"
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].color = {0, 80, 255}
    tt.spawner.count = 3
    tt.spawner.cycle_time = fts(6)
    tt.spawner.entity = "enemy_sarelgaz_small"
    tt.spawner.node_offset = 5
    tt.spawner.pos_offset = vec_2(0, 1)
    tt.spawner.allowed_subpaths = {1, 2, 3}
    tt.spawner.random_subpath = false
    tt.spawner.animation_start = "start"
    tt.tween.disabled = true
    tt.tween.props[1].keys = {{0, 255}, {4, 0}}
    tt.tween.remove = true

    -- 古拉克
    tt = RT("eb_gulthak", "boss")
    AC(tt, "melee", "timed_attacks")
    anchor_y = 0.11
    anchor_x = 0.5
    tt.enemy.gold = 0
    image_y = 196
    image_x = 340
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(60, 0)
    tt.health.dead_lifetime = 8
    tt.health.hp_max = 12000
    tt.health_bar.offset = vec_2(0, 95)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.health.magic_armor = 0.1
    tt.info.i18n_key = "EB_GOBLIN_CHIEFTAIN"
    tt.info.enc_icon = 40
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0063" or "info_portraits_sc_0063"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.enemy_shaman.update
    tt.melee.attacks[1].cooldown = 1 + fts(20)
    tt.melee.attacks[1].damage_max = 600
    tt.melee.attacks[1].damage_min = 200
    tt.melee.attacks[1].hit_time = fts(11)
    tt.motion.max_speed = 0.4 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_gulthak"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles_flip_vertical = {
        walk = true
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "DeathBig"
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect = r(-50, 0, 90, 60)
    tt.unit.can_explode = false
    tt.unit.can_disintegrate = false
    tt.unit.fade_time_after_death = 2
    tt.unit.hit_offset = vec_2(0, 30)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 27)
    tt.unit.marker_hidden = true
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.timed_attacks.list[1] = E:clone_c("mod_attack")
    tt.timed_attacks.list[1].animation = "heal"
    tt.timed_attacks.list[1].cast_time = fts(14)
    tt.timed_attacks.list[1].cooldown = 8
    tt.timed_attacks.list[1].max_count = 20
    tt.timed_attacks.list[1].max_range = 320
    tt.timed_attacks.list[1].mod = "mod_gulthak_heal"
    tt.timed_attacks.list[1].sound = "EnemyHealing"
    tt.timed_attacks.list[1].vis_flags = bor(F_MOD)

    -- 绿泥树怪
    tt = RT("eb_greenmuck", "boss")
    AC(tt, "melee", "timed_attacks")
    anchor_y = 0.1402439024390244
    anchor_x = 0.5
    image_y = 232
    image_x = 244
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.dead_lifetime = 8
    tt.health.hp_max = 8000
    tt.health.armor = 0.8
    tt.health_bar.offset = vec_2(0, 135)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_greenmuck.get_info
    tt.info.i18n_key = "EB_GREENMUCK"
    tt.info.enc_icon = 45
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0069" or "info_portraits_sc_0069"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_greenmuck.update
    tt.motion.max_speed = 0.3 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_greenmuck"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = nil
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect = r(-30, 0, 60, 110)
    tt.unit.blood_color = BLOOD_GRAY
    tt.unit.fade_time_after_death = 2
    tt.unit.hit_offset = vec_2(0, 37)
    tt.unit.marker_offset = vec_2(0, -10)
    tt.unit.marker_hidden = true
    tt.unit.mod_offset = vec_2(0, 37)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 250
    tt.melee.attacks[1].damage_min = 150
    tt.melee.attacks[1].damage_radius = 60
    tt.melee.attacks[1].count = 10
    tt.melee.attacks[1].hit_time = fts(10)
    tt.melee.attacks[1].hit_offset = tt.enemy.melee_slot
    tt.timed_attacks.list[1] = E:clone_c("custom_attack")
    tt.timed_attacks.list[1].animation = "shoot"
    tt.timed_attacks.list[1].bullet = "bomb_greenmuck"
    tt.timed_attacks.list[1].count = 7
    tt.timed_attacks.list[1].bullet_start_offset = vec_2(0, 120)
    tt.timed_attacks.list[1].cooldown = 6
    tt.timed_attacks.list[1].shoot_time = fts(13)
    tt.timed_attacks.list[1].vis_flags = F_RANGED
    tt.timed_attacks.list[1].vis_bans = F_ENEMY

    -- 金并
    tt = RT("eb_kingpin", "enemy")
    AC(tt, "melee", "timed_attacks", "auras")
    anchor_y = 0.13
    anchor_x = 0.5
    image_y = 204
    image_x = 218
    tt.auras.list[1] = E:clone_c("aura_attack")
    tt.auras.list[1].name = "kingpin_damage_aura"
    tt.auras.list[1].cooldown = 0
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(60, 0)
    tt.health.dead_lifetime = 12
    tt.health.hp_max = 12000
    tt.health_bar.offset = vec_2(0, 125)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_kingpin.get_info
    tt.info.i18n_key = "EB_BANDIT"
    tt.info.enc_icon = 48
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0072" or "info_portraits_sc_0072"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_kingpin.update
    tt.motion.max_speed = 0.35 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.13)
    tt.render.sprites[1].prefix = "eb_kingpin"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "DeathJuggernaut"
    tt.sound_events.insert = "MusicBossFight"
    tt.stop_time = 5
    tt.stop_cooldown = 5
    tt.stop_wait = fts(20)
    tt.ui.click_rect = r(-50, 0, 100, 75)
    tt.unit.fade_time_after_death = 2
    tt.unit.hit_offset = vec_2(0, 80)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 82)
    tt.unit.size = UNIT_SIZE_MEDIUM
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH, F_BLOCK)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 1 + fts(20)
    tt.melee.attacks[1].damage_max = 100
    tt.melee.attacks[1].damage_min = 100
    tt.melee.attacks[1].damage_radius = 65
    tt.melee.attacks[1].count = 10
    tt.melee.attacks[1].hit_time = fts(15)
    tt.melee.attacks[1].hit_offset = tt.enemy.melee_slot
    tt.melee.attacks[1].hit_fx = "fx_juggernaut_smoke"
    tt.timed_attacks.list[1] = E:clone_c("mod_attack")
    tt.timed_attacks.list[1].animation = "eat"
    tt.timed_attacks.list[1].cast_time = fts(14)
    tt.timed_attacks.list[1].cooldown = 5
    tt.timed_attacks.list[1].max_count = 1
    tt.timed_attacks.list[1].max_range = 320
    tt.timed_attacks.list[1].mod = "mod_kingpin_heal_self"
    tt.timed_attacks.list[1].sound = "EnemyHealing"
    tt.timed_attacks.list[1].vis_flags = bor(F_MOD)
    tt.timed_attacks.list[2] = table.deepclone(tt.timed_attacks.list[1])
    tt.timed_attacks.list[2].animation = "heal"
    tt.timed_attacks.list[2].max_count = 9999
    tt.timed_attacks.list[2].max_range = 100
    tt.timed_attacks.list[2].mod = "mod_kingpin_heal_others"

    -- 阿古克汗
    tt = RT("eb_ulgukhai", "boss")
    AC(tt, "melee", "auras")
    anchor_y = 0.1792452830188679
    anchor_x = 0.5
    image_y = 150
    image_x = 240
    tt.auras.list[1] = E:clone_c("aura_attack")
    tt.auras.list[1].name = "aura_ulgukhai_regen"
    tt.auras.list[1].cooldown = 0
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.dead_lifetime = 12
    tt.health.hp_max = 9000
    tt.health.armor = 0.55
    tt.health_bar.offset = vec_2(0, 90)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_ulgukhai.get_info
    tt.info.i18n_key = "EB_ULGUKHAI"
    tt.info.enc_icon = 52
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0075" or "info_portraits_sc_0075"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_ulgukhai.update
    tt.motion.max_speed = 0.3 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_ulgukhai"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "DeathBig"
    tt.sound_events.insert = "MusicBossFight"
    tt.unit.blood_color = BLOOD_GRAY
    tt.ui.click_rect = r(-25, 5, 50, 65)
    tt.unit.fade_time_after_death = 2
    tt.unit.hit_offset = vec_2(0, 30)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 26)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.shielded_extra_vis_bans = bor(F_MOD, F_POISON)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 3
    tt.melee.attacks[1].damage_max = 350
    tt.melee.attacks[1].damage_min = 150
    tt.melee.attacks[1].damage_radius = 57.6
    tt.melee.attacks[1].count = 10
    tt.melee.attacks[1].hit_time = fts(16)
    tt.melee.attacks[1].hit_offset = vec_2(60, 0)
    tt.melee.attacks[1].hit_decal = "decal_ground_hit"
    tt.melee.attacks[1].hit_fx = "fx_ground_hit"
    tt.melee.attacks[1].sound_hit = "AreaAttack"

    -- 摩洛克
    tt = RT("eb_moloch", "boss")
    AC(tt, "melee", "timed_attacks")
    anchor_y = 0.105
    anchor_x = 0.5
    image_y = 282
    image_x = 282
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(33, 0)
    tt.health.dead_lifetime = 100
    tt.health.ignore_damage = true
    tt.health.hp_max = {11111, 13333, 15555, 18888}
    tt.health.magic_armor = 0.5
    tt.health_bar.offset = vec_2(0, 125)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.i18n_key = "EB_MOLOCH"
    tt.info.enc_icon = 57
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0080" or "info_portraits_sc_0080"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_moloch.update
    tt.motion.max_speed = 0.6 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_moloch"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "EnemyInfernoBossDeath"
    tt.ui.click_rect = r(-25, 0, 50, 100)
    tt.unit.hit_offset = vec_2(0, 60)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 45)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_ALL)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.stand_up_wait_time = fts(14)
    tt.stand_up_sound = "MusicBossFight"
    tt.pos_sitting = vec_2(526, 614)
    tt.nav_path.pi = 2
    tt.nav_path.spi = 1
    tt.nav_path.ni = 1
    tt.wave_active = 16
    tt.active_vis_bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 1.5 + fts(25)
    tt.melee.attacks[1].damage_max = 120
    tt.melee.attacks[1].damage_min = 80
    tt.melee.attacks[1].damage_radius = 40
    tt.melee.attacks[1].count = nil
    tt.melee.attacks[1].hit_time = fts(15)
    tt.melee.attacks[1].hit_offset = tt.enemy.melee_slot
    tt.melee.attacks[1].hit_fx = "fx_moloch_ring"
    tt.melee.attacks[1].sound_hit = "EnemyInfernoStomp"
    tt.timed_attacks.list[1] = CC("area_attack")
    tt.timed_attacks.list[1].cooldown = 7
    tt.timed_attacks.list[1].animation = "horn_attack"
    tt.timed_attacks.list[1].damage_radius = 100
    tt.timed_attacks.list[1].damage_type = DAMAGE_INSTAKILL
    tt.timed_attacks.list[1].hit_time = fts(15)
    tt.timed_attacks.list[1].min_targets = 2
    tt.timed_attacks.list[1].fx_list = {{"fx_moloch_rocks",
                                         {{36, -30}, {1, -10}, {90, -23}, {87, 5}, {49, -3}, {54, 17}}},
                                        {"fx_moloch_ring", {{45, 0}}}}
    tt.timed_attacks.list[1].hit_offset = vec_2(20, 0)
    tt.timed_attacks.list[1].sound = "EnemyInfernoHorns"
    tt.timed_attacks.list[1].sound_args = {
        delay = fts(5)
    }
    tt.is_demon = true

    -- 蘑菇人
    tt = RT("eb_myconid", "boss")
    AC(tt, "melee", "timed_attacks")
    anchor_y = 0.16428571428571428
    anchor_x = 0.5
    image_y = 140
    image_x = 174
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.dead_lifetime = 12
    tt.health.hp_max = 4500
    tt.health_bar.offset = vec_2(0, 100)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.i18n_key = "EB_MYCONID"
    tt.info.enc_icon = 59
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0082" or "info_portraits_sc_0082"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_myconid.update
    tt.motion.max_speed = 0.65 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_myconid"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "EnemyMushroomBossDeath"
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect = r(-25, 0, 50, 80)
    tt.unit.fade_time_after_death = 4
    tt.unit.blood_color = BLOOD_VIOLET
    tt.unit.hit_offset = vec_2(0, 33)
    tt.unit.mod_offset = vec_2(0, 33)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.spawner_entity = "myconid_spawner"
    tt.on_death_spawn_count = 12
    tt.on_death_spawn_wait = fts(40)
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 350
    tt.melee.attacks[1].damage_min = 150
    tt.melee.attacks[1].hit_time = fts(9)
    tt.timed_attacks.list[1] = E:clone_c("custom_attack")
    tt.timed_attacks.list[1].animation = "spores"
    tt.timed_attacks.list[1].cooldown = 5
    tt.timed_attacks.list[1].final_wait = fts(20)
    tt.timed_attacks.list[1].fx = "fx_myconid_spores"
    tt.timed_attacks.list[1].fx_offset = vec_2(0, 40)
    tt.timed_attacks.list[1].min_nodes = 25
    tt.timed_attacks.list[1].mod = "mod_myconid_poison"
    tt.timed_attacks.list[1].radius = 110
    tt.timed_attacks.list[1].sound = "EnemyMushroomGas"
    tt.timed_attacks.list[1].summon_counts = {2, 3, 3, 4, 4, 4, 3, 2}
    tt.timed_attacks.list[1].vis_bans = F_ENEMY
    tt.timed_attacks.list[1].vis_flags = bor(F_MOD, F_POISON)
    tt.timed_attacks.list[1].wait_times = {fts(15), fts(3), fts(6)}

    -- 布莱克本
    tt = RT("eb_blackburn", "boss")
    AC(tt, "melee", "timed_attacks", "auras")
    anchor_y = 0.16993464052287582
    anchor_x = 0.5
    image_y = 308
    image_x = 314
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.dead_lifetime = 100
    tt.health.armor = 0.95
    tt.health.hp_max = 11000
    tt.health_bar.offset = vec_2(0, 125)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_blackburn.get_info
    tt.info.i18n_key = "EB_BLACKBURN"
    tt.info.enc_icon = 69
    tt.info.portrait = IS_PHONE_OR_TABLET and "portraits_sc_0093" or "info_portraits_sc_0092"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_blackburn.update
    tt.motion.max_speed = 0.5 * FPS
    tt.render.sprites[1].anchor = vec_2(anchor_x, anchor_y)
    tt.render.sprites[1].prefix = "eb_blackburn"
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {
        walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    }
    tt.sound_events.death = "EnemyBlackburnBossDeath"
    tt.sound_events.insert = "MusicBossFight"
    tt.ui.click_rect.pos.y = 9
    tt.unit.hit_offset = vec_2(adx(150), ady(115))
    tt.unit.marker_offset = vec_2(0, 11)
    tt.unit.mod_offset = vec_2(0, ady(115))
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_TELEPORT, F_THORN, F_POLYMORPH)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.auras.list[1] = E:clone_c("aura_attack")
    tt.auras.list[1].name = "blackburn_aura"
    tt.auras.list[1].cooldown = 0
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 1.3 + fts(40)
    tt.melee.attacks[1].damage_max = 200
    tt.melee.attacks[1].damage_min = 100
    tt.melee.attacks[1].damage_radius = 63.829787234042556
    tt.melee.attacks[1].dodge_time = fts(13)
    tt.melee.attacks[1].hit_time = fts(15)
    tt.melee.attacks[1].sound_hit = "EnemyBlackburnBossSwing"
    tt.melee.attacks[1].vis_bans = bor(F_STUN)
    tt.timed_attacks.list[1] = CC("custom_attack")
    tt.timed_attacks.list[1].after_hit_wait = fts(20)
    tt.timed_attacks.list[1].animation = "smash"
    tt.timed_attacks.list[1].aura_shake = "aura_screen_shake"
    tt.timed_attacks.list[1].cooldown = fts(300)
    tt.timed_attacks.list[1].after_cooldown = fts(150)
    tt.timed_attacks.list[1].damage_max = 5
    tt.timed_attacks.list[1].damage_min = 1
    tt.timed_attacks.list[1].damage_type = DAMAGE_TRUE
    tt.timed_attacks.list[1].damage_radius = 106.38297872340426
    tt.timed_attacks.list[1].fx = "fx_blackburn_smash"
    tt.timed_attacks.list[1].fx_offset = vec_2(26, 7)
    tt.timed_attacks.list[1].hit_decal = "decal_blackburn_smash_ground"
    tt.timed_attacks.list[1].hit_time = fts(24)
    tt.timed_attacks.list[1].min_range = 0
    tt.timed_attacks.list[1].max_range = 283.68794326241135
    tt.timed_attacks.list[1].mod = "mod_blackburn_stun"
    tt.timed_attacks.list[1].mod_towers = "mod_blackburn_tower"
    tt.timed_attacks.list[1].sound = "EnemyBlackburnBossSpecialStomp"
    tt.timed_attacks.list[1].sound_args = {
        delay = fts(13)
    }
    tt.timed_attacks.list[1].vis_flags = bor(F_MOD)

    -- unknown
    tt = E:register_t("eb_elder_shaman", "decal_scripted")
    E:add_comps(tt, "attacks")
    tt.attacks.animation = "cast"
    tt.attacks.delay = {0.6, 0.9}
    tt.attacks.list[1] = E:clone_c("aura_attack")
    tt.attacks.list[1].aura = "aura_elder_shaman_healing"
    tt.attacks.list[1].node_offset = {10, 30}
    tt.attacks.list[1].path_margins = {40, 10}
    tt.attacks.list[1].power_name = "healing"
    tt.attacks.list[1].vis_bans = bor(F_FLYING, F_BOSS, F_FRIEND)
    tt.attacks.list[1].vis_flags = bor(F_MOD)
    tt.attacks.list[2] = E:clone_c("aura_attack")
    tt.attacks.list[2].aura = "aura_elder_shaman_damage"
    tt.attacks.list[2].power_name = "damage"
    tt.attacks.list[2].vis_bans = bor(F_FLYING, F_BOSS, F_ENEMY)
    tt.attacks.list[2].vis_flags = bor(F_MOD)
    tt.attacks.list[2].enemy_vis_bans = bor(F_FLYING, F_BOSS)
    tt.attacks.list[2].enemy_vis_flags = bor(F_MOD)
    tt.attacks.list[3] = E:clone_c("aura_attack")
    tt.attacks.list[3].aura = "aura_elder_shaman_speed"
    tt.attacks.list[3].node_offset = {10, 30}
    tt.attacks.list[3].path_margins = {25, 40}
    tt.attacks.list[3].power_name = "speed"
    tt.attacks.list[3].vis_bans = bor(F_FLYING, F_BOSS, F_FRIEND)
    tt.attacks.list[3].vis_flags = bor(F_MOD)
    tt.main_script.update = scripts.eb_elder_shaman.update
    tt.render.sprites[1].prefix = "eb_elder_shaman"
    tt.render.sprites[1].name = "idle"
    tt.render.sprites[1].anchor.y = 0.09259259259259259
    tt.taunt = {
        delay_min = 15,
        delay_max = 20,
        duration = 4,
        sets = {
            welcome = {},
            prebattle = {},
            battle = {},
            life_lost = {},
            totem = {}
        }
    }
    tt.taunt.sets.welcome.format = "ENDLESS_BOSS_ORC_TAUNT_WELCOME_%04d"
    tt.taunt.sets.welcome.start_idx = 1
    tt.taunt.sets.welcome.end_idx = 2
    tt.taunt.sets.prebattle.format = "ENDLESS_BOSS_ORC_TAUNT_PREBATTLE_%04d"
    tt.taunt.sets.prebattle.start_idx = 1
    tt.taunt.sets.prebattle.end_idx = 4
    tt.taunt.sets.battle.format = "ENDLESS_BOSS_ORC_TAUNT_GENERIC_%04d"
    tt.taunt.sets.battle.start_idx = 1
    tt.taunt.sets.battle.end_idx = 9
    tt.taunt.sets.life_lost.format = "ENDLESS_BOSS_ORC_TAUNT_LIFE_LOST_%04d"
    tt.taunt.sets.life_lost.start_idx = 1
    tt.taunt.sets.life_lost.end_idx = 1
    tt.taunt.sets.totem.format = "ENDLESS_BOSS_ORC_TAUNT_TOTEM_%04d"
    tt.taunt.sets.totem.start_idx = 1
    tt.taunt.sets.totem.end_idx = 1
    tt.taunt.offset = vec_2(0, -75)
    tt.taunt.ts = 0
    tt.taunt.next_ts = 0

    tt = RT("decal_elder_shaman_shoutbox", "decal_tween")
    AC(tt, "texts")
    tt.render.sprites[1].name = "HalloweenBoss_tauntBox"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].z = Z_BULLETS
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].z = Z_BULLETS
    tt.render.sprites[2].offset = vec_2(0, -9)
    tt.texts.list[1].text = "Hello world"
    tt.texts.list[1].size = vec_2(172, 62)
    tt.texts.list[1].font_name = "body_bold"
    tt.texts.list[1].font_size = 20
    tt.texts.list[1].color = {255, 114, 114}
    tt.texts.list[1].line_height = 0.8
    tt.texts.list[1].sprite_id = 2
    tt.texts.list[1].fit_height = true
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_2(1.01, 1.01)}, {0.4, vec_2(0.99, 0.99)}, {0.8, vec_2(1.01, 1.01)}}
    tt.tween.props[1].sprite_id = 1
    tt.tween.props[1].loop = true
    tt.tween.props[2] = table.deepclone(tt.tween.props[1])
    tt.tween.props[2].sprite_id = 2
    tt.tween.props[3] = E:clone_c("tween_prop")
    tt.tween.props[3].keys = {{0, 0}, {0.25, 255}}
    tt.tween.props[3].sprite_id = 1
    tt.tween.props[4] = table.deepclone(tt.tween.props[3])
    tt.tween.props[4].sprite_id = 2
    tt.tween.remove = false

    -- 纳泽鲁
    tt = E:register_t("eb_efreeti", "boss")
    E:add_comps(tt, "attacks", "tween")
    anchor_y = 0.1
    image_y = 198
    tt.attacks.cooldown = 7
    tt.attacks.list[1] = E:clone_c("custom_attack")
    tt.attacks.list[1].animation = "attack"
    tt.attacks.list[1].chance = 0.2
    tt.attacks.list[1].hit_time = fts(13)
    tt.attacks.list[1].max_count = 3
    tt.attacks.list[1].max_range = 320
    tt.attacks.list[1].min_range = 76.8
    tt.attacks.list[2] = E:clone_c("custom_attack")
    tt.attacks.list[2].animation = "attack"
    tt.attacks.list[2].hit_time = fts(13)
    tt.attacks.list[2].max_count = 10
    tt.attacks.list[2].max_range = 96
    tt.attacks.list[2].min_range = 0
    tt.attacks.list[3] = E:clone_c("mod_attack")
    tt.attacks.list[3].animation = "attack_sand"
    tt.attacks.list[3].chance = 0.3
    tt.attacks.list[3].max_count = 3
    tt.attacks.list[3].max_range = 192
    tt.attacks.list[3].mod = "mod_efreeti"
    tt.attacks.list[3].shoot_time = fts(19)
    tt.attacks.list[4] = E:clone_c("spawn_attack")
    tt.attacks.list[4].animation = "attack"
    tt.attacks.list[4].coords = {vec_2(816, 430), vec_2(415, 490), vec_2(270, 340), vec_2(690, 290)}
    tt.attacks.list[4].entity = "enemy_efreeti_small"
    tt.attacks.list[4].health_threshold = 3000
    tt.attacks.list[4].max_count = 2
    tt.attacks.list[4].spawn_time = fts(13)
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(50, 0)
    tt.health.dead_lifetime = fts(200)
    tt.health.hp_max = 9000
    tt.health_bar.offset = vec_2(0, ady(195))
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_efreeti.get_info
    tt.info.portrait = IS_PHONE and "portraits_sc_0040" or "kr2_info_portraits_enemies_0015"
    tt.info.enc_icon = 14
    tt.main_script.insert = scripts.eb_efreeti.insert
    tt.main_script.update = scripts.eb_efreeti.update
    tt.motion.max_speed = 0.375 * FPS
    tt.render.sprites[1] = E:clone_c("sprite")
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].loop_forced = true
    tt.render.sprites[1].prefix = "eb_efreeti_legs"
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].anchor.y = anchor_y
    tt.render.sprites[2].angles = {}
    tt.render.sprites[2].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[2].prefix = "eb_efreeti"
    tt.render.sprites[3] = E:clone_c("sprite")
    tt.render.sprites[3].anchor.y = anchor_y
    tt.render.sprites[3].angles = {}
    tt.render.sprites[3].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[3].loop_forced = true
    tt.render.sprites[3].prefix = "eb_efreeti_belt"
    tt.tween.props[1].keys = {{0, 0}, {1.5, 255}}
    tt.tween.props[1].sprite_id = 1
    tt.tween.props[2] = E:clone_c("tween_prop")
    tt.tween.props[2].keys = {{0, 0}, {1.5, 255}}
    tt.tween.props[2].sprite_id = 2
    tt.tween.props[3] = E:clone_c("tween_prop")
    tt.tween.props[3].keys = {{0, 0}, {1.5, 255}}
    tt.tween.props[3].sprite_id = 3
    tt.tween.remove = false
    tt.ui.click_rect = r(-40, -5, 80, 160)
    tt.unit.hide_after_death = true
    tt.unit.hit_offset = vec_2(0, 103)
    tt.unit.marker_hidden = true
    tt.unit.mod_offset = vec_2(0, ady(104))
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = F_ALL
    tt.vis.bans_in_battlefield = bor(F_SKELETON)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.sound_events.insert = "MusicBossFight"
    tt.sound_events.laugh = "BossEfreetiLaugh"
    tt.sound_events.death = "BossEfreetiDeath"
    tt.sound_events.desintegrate = "BossEfreetiSnap"
    tt.sound_events.polymorph = "BossEfreetiSnap"
    tt.sound_events.spawn = "BossEfreetiSnap"
    tt.sound_events.sand = "BossEfreetiClap"

    tt = E:register_t("mod_efreeti", "modifier")
    E:add_comps(tt, "render")
    tt.main_script.update = scripts.mod_tower_block.update
    tt.modifier.duration = 10
    tt.modifier.hide_tower = true
    tt.render.sprites[1].anchor.y = 0.17
    tt.render.sprites[1].draw_order = 10
    tt.render.sprites[1].z = Z_OBJECTS
    tt.render.sprites[1].name = "start"
    tt.render.sprites[1].prefix = "efreeti_sandblock_tower"
    tt.sound_events.finish = "BossEfreetiTowerReleased"

    tt = E:register_t("eb_gorilla", "boss")
    E:add_comps(tt, "melee", "attacks", "idle_flip")
    anchor_y = 0.21
    image_y = 172
    tt.jump_down_advance_nodes = 10
    tt.nodes_limit = 30
    tt.on_tower_time = 9
    tt.tower_pos_left = nil
    tt.tower_pos_right = nil
    tt.attacks.list[1] = E:clone_c("spawn_attack")
    tt.attacks.list[1].animation = "call"
    tt.attacks.list[1].cooldown = 8
    tt.attacks.list[1].entity = "gorilla_small_liana"
    tt.attacks.list[1].max_count = 8
    tt.attacks.list[1].sound = "BossMonkeyChestPounding"
    tt.attacks.list[1].spawn_node_ranges = {{{62, 113}, {130, 150}}, {{60, 105}, {120, 140}}}
    tt.attacks.list[2] = E:clone_c("custom_attack")
    tt.attacks.list[2].cooldown = 10
    tt.attacks.list[2].points = 500
    tt.attacks.list[2].sound = "EnemyHealing"
    tt.attacks.list[3] = E:clone_c("bullet_attack")
    tt.attacks.list[3].animation = "throw_barrel"
    tt.attacks.list[3].bullet = "gorilla_boss_barrel"
    tt.attacks.list[3].bullet_start_offset = {vec_2(60, 70)}
    tt.attacks.list[3].cooldown = 2
    tt.attacks.list[3].max_range = 448
    tt.attacks.list[3].min_range = 50
    tt.attacks.list[3].shoot_time = fts(9)
    tt.attacks.list[3].vis_bans = bor(F_FLYING, F_ENEMY)
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(50, 0)
    tt.health.dead_lifetime = fts(300)
    tt.health.hp_max = 8000
    tt.health_bar.offset = vec_2(0, ady(160))
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.idle_flip.chance = 1
    tt.idle_flip.cooldown = 5
    tt.info.fn = scripts.eb_gorilla.get_info
    tt.info.portrait = IS_PHONE and "portraits_sc_0068" or "kr2_info_portraits_enemies_0039"
    tt.info.enc_icon = 38
    tt.main_script.insert = scripts.eb_gorilla.insert
    tt.main_script.update = scripts.eb_gorilla.update
    tt.melee.attacks[1] = E:clone_c("area_attack")
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].count = 10
    tt.melee.attacks[1].damage_max = 500
    tt.melee.attacks[1].damage_min = 200
    tt.melee.attacks[1].damage_radius = 44.800000000000004
    tt.melee.attacks[1].damage_type = DAMAGE_PHYSICAL
    tt.melee.attacks[1].hit_decal = "decal_ground_hit"
    tt.melee.attacks[1].hit_fx = "fx_ground_hit"
    tt.melee.attacks[1].hit_offset = vec_2(50, 0)
    tt.melee.attacks[1].hit_time = fts(17)
    tt.melee.attacks[1].sound = "BossMonkeySmashGround"
    tt.motion.max_speed = 0.534 * FPS
    tt.render.sprites[1] = E:clone_c("sprite")
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].prefix = "eb_gorilla"
    tt.sound_events.death = "BossMonkeyDeath"
    tt.sound_events.insert = "MusicBossFight"
    tt.sound_events.jump_to_tower = "BossMonkeyJumpToTotem"
    tt.sound_events.drop_from_sky = "BossMonkeyFallSpawn"
    tt.unit.hit_offset = vec_2(0, 45)
    tt.unit.marker_hidden = true
    tt.unit.mod_offset = vec_2(0, ady(73))
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_SKELETON, F_BLOOD)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)

    tt = E:register_t("fx_gorilla_boss_heal", "fx")
    tt.render.sprites[1].name = "fx_gorilla_boss_heal"
    tt.render.sprites[1].anchor.y = 0.21

    tt = E:register_t("fx_gorilla_boss_jump_smoke", "fx")
    tt.render.sprites[1].name = "fx_gorilla_boss_jump_smoke"
    tt.render.sprites[1].anchor.y = 0.12

    tt = E:register_t("gorilla_boss_barrel", "bomb")
    tt.bullet.flight_time_base = fts(30)
    tt.bullet.flight_time_factor = fts(0.025)
    tt.bullet.g = -0.85 / (fts(1) * fts(1))
    tt.bullet.warp_time = 2
    tt.bullet.damage_min = 100
    tt.bullet.damage_max = 150
    tt.bullet.damage_radius = 51.2
    tt.bullet.damage_bans = F_ENEMY
    tt.bullet.damage_flags = F_AREA
    tt.bullet.damage_decay_random = true
    tt.bullet.pop = nil
    tt.render.sprites[1].name = "CanibalBoos_Proy"
    tt.main_script.insert = scripts.enemy_bomb.insert
    tt.main_script.update = scripts.enemy_bomb.update

    tt = E:register_t("enemy_gorilla_small", "enemy")
    E:add_comps(tt, "melee")
    anchor_y = 0.21
    image_y = 68
    tt.enemy.gold = 50
    tt.enemy.lives_cost = 2
    tt.enemy.melee_slot = vec_2(26, 0)
    tt.health.armor = 0
    tt.health.hp_max = 1200
    tt.health.magic_armor = 0
    tt.health_bar.offset = vec_2(0, ady(64))
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM
    tt.info.portrait = IS_PHONE and "portraits_sc_0067" or "kr2_info_portraits_enemies_0038"
    tt.info.enc_icon = 39
    tt.main_script.insert = scripts.enemy_gorilla_small.insert
    tt.main_script.update = scripts.enemy_mixed.update
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 100
    tt.melee.attacks[1].damage_min = 50
    tt.melee.attacks[1].hit_time = fts(12)
    tt.motion.max_speed = 1.067 * FPS
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].name = "idle"
    tt.render.sprites[1].prefix = "enemy_gorilla_small"
    tt.render.sprites[1].angles_flip_vertical = {
        walk = true
    }
    tt.unit.hit_offset = vec_2(0, 14)
    tt.unit.marker_offset = vec_2(0, ady(13))
    tt.unit.mod_offset = vec_2(0, ady(28))
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_MEDIUM
    tt.sound_events.death = "DeathBig"

    tt = E:register_t("gorilla_small_liana", "decal_scripted")
    E:add_comps(tt, "sound_events")
    tt.main_script.update = scripts.gorilla_small_liana.update
    tt.render.sprites[1].flip_x = true
    tt.render.sprites[1].name = "gorilla_small_liana"
    tt.spawn_name = "gorilla_small_falling"
    tt.spawn_offset = {vec_2(-130, 38), vec_2(130, 38)}
    tt.spawn_time = fts(8)
    tt.spawn_dest = nil
    tt.sound_events.insert = "BossMonkeyMonkeysScreams"

    tt = E:register_t("gorilla_small_falling", "bomb")
    tt.render.sprites[1].name = "CanibalBoos_Offspring_0030"
    tt.bullet.flight_time = fts(27)
    tt.bullet.vis_bans = F_ALL
    tt.bullet.hit_fx = "enemy_gorilla_small"
    tt.bullet.hit_decal = nil
    tt.bullet.pop = nil
    tt.bullet.hide_radius = nil
    tt.bullet.rotation_speed = nil
    tt.sound_events.insert = nil
    tt.sound_events.hit = nil
    tt.sound_events.hit_water = nil

    tt = E:register_t("eb_umbra", "boss")
    E:add_comps(tt, "melee", "attacks")
    anchor_y = 0.18
    image_y = 176
    tt.attacks.list[1] = E:clone_c("spawn_attack")
    tt.attacks.list[1].animation = "open_portals"
    tt.attacks.list[1].cooldowns = {}
    tt.attacks.list[1].cooldowns.at_home = {3, 3, 1, 1, 0, 0, 0, 2, 2, 2}
    tt.attacks.list[1].cooldowns.on_battlefield = {0, 0, 0, 0, 3, 3, 3, 3, 3, 3}
    tt.attacks.list[1].cooldown = nil
    tt.attacks.list[1].entity = "umbra_portal"
    tt.attacks.list[1].nodes_left = {{np(1, 1, 53), np(2, 1, 53)}, {np(1, 1, 85), np(2, 1, 85)}}
    tt.attacks.list[1].nodes_right = {{np(3, 1, 26), np(4, 1, 24)}, {np(3, 1, 68), np(4, 1, 69)}}
    tt.attacks.list[1].count_min = 3
    tt.attacks.list[1].add_per_missing_piece = 0.4
    tt.attacks.list[2] = E:clone_c("custom_attack")
    tt.attacks.list[2].cooldowns = {}
    tt.attacks.list[2].cooldowns.at_home = {7, 7, 7, 7, 8, 8, 8, 8, 8, 8}
    tt.attacks.list[2].cooldowns.on_battlefield = {6, 6, 6, 6, 8, 8, 8, 8, 8, 8}
    tt.attacks.list[2].cooldown = nil
    tt.attacks.list[2].max_side_jumps = 3
    tt.attacks.list[2].nodes_battlefield = {np(5, 1, 48), np(2, 1, 69), np(3, 1, 51)}
    tt.attacks.list[3] = E:clone_c("bullet_attack")
    tt.attacks.list[3].animation = "eyes"
    tt.attacks.list[3].bullet = "ray_umbra"
    tt.attacks.list[3].bullet_start_offset = {vec_2(-9, ady(109)), vec_2(9, ady(109))}
    tt.attacks.list[3].cooldown = 2.5
    tt.attacks.list[3].max_range = 192
    tt.attacks.list[3].shoot_time = fts(17)
    tt.attacks.list[3].vis_bans = bor(F_FLYING, F_ENEMY)
    tt.attacks.list[3].sound = "FrontiersFinalBossRay"
    tt.attacks.list[4] = table.deepclone(tt.attacks.list[3])
    tt.attacks.list[4].inner_towers = {"3", "4", "5", "8", "11", "13"}
    tt.attacks.list[4].lower_towers = {"7", "9", "15", "16"}
    tt.attacks.list[4].cooldowns = {}
    tt.attacks.list[4].cooldowns.at_home = {2, 2, 0, 0, 1, 1, 1, 0, 0, 0}
    tt.attacks.list[4].cooldowns.on_battlefield = {1, 2, 2, 2, 0, 0, 0, 0, 0, 0}
    tt.attacks.list[4].bullet = "ray_umbra_tower"
    tt.attacks.list[4].sound = "FrontiersFinalBossRayTower"
    tt.attacks.list[5] = E:clone_c("spawn_attack")
    tt.attacks.list[5].entity = "enemy_umbra_piece_flying"
    tt.attacks.list[5].payload_entity = "enemy_umbra_piece"
    tt.attacks.list[5].start_offset_x = {-20, 20}
    tt.attacks.list[5].start_offset_y = {60, 80}
    tt.attacks.list[5].dest_pi = {5, 6, 7, 8, 9}
    tt.attacks.list[5].initial_ni = 20
    tt.attacks.list[5].limit_ni = 50
    tt.attacks.list[5].cooldown = 30
    tt.attacks.list[5].callback_pieces = {7, 4, 2}
    tt.attacks.list[5].min_pieces_to_respawn = 3
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(25, 0)
    tt.health.dead_lifetime = fts(1000)
    tt.health.hp_max = {7000, 9000, 9999, 11111}
    tt.health_bar.offset = vec_2(0, ady(166))
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.health_bar.hidden = true
    tt.info.fn = scripts.eb_umbra.get_info
    tt.info.portrait = IS_PHONE and "portraits_sc_0070" or "kr2_info_portraits_enemies_0040"
    tt.info.enc_icon = 40
    tt.main_script.insert = scripts.eb_umbra.insert
    tt.main_script.update = scripts.eb_umbra.update
    tt.motion.max_speed = 0.534 * FPS
    tt.render.sprites[1] = E:clone_c("sprite")
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].prefix = "eb_umbra"
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].prefix = "eb_umbra"
    tt.render.sprites[2].name = "eyes"
    tt.render.sprites[2].hidden = true
    tt.render.sprites[2].anchor.y = anchor_y
    tt.taunt = {}
    tt.taunt.cooldown = 4
    tt.taunt.format = "FINAL_BOSS_TAUNT_%04d"
    tt.taunt.start_idx = 3
    tt.taunt.end_idx = 25
    tt.taunt.left_pos = vec_2(331, 677)
    tt.taunt.right_pos = vec_2(696, 677)
    tt.taunt.duration = 4
    tt.taunt.ts = 0
    tt.unit.blood_color = BLOOD_GRAY
    tt.unit.hit_offset = vec_2(0, 55)
    tt.unit.marker_hidden = true
    tt.unit.mod_offset = vec_2(0, ady(80))
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans_at_home = bor(F_RANGED, F_SKELETON, F_MOD, F_BLOCK, F_LETHAL, F_FREEZE)
    tt.vis.bans_in_battlefield = bor(F_SKELETON, F_POISON, F_LETHAL, F_FREEZE)
    tt.vis.bans_in_pieces = F_ALL
    tt.vis.bans = tt.vis.bans_at_home
    tt.vis.flags = bor(F_ENEMY, F_BOSS)

    tt = E:register_t("decal_umbra_shoutbox", "decal_tween")
    E:add_comps(tt, "texts", "timed")
    tt.render.sprites[1].name = "finalBoss_tauntBox"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].z = Z_BULLETS
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].z = Z_BULLETS
    tt.render.sprites[2].offset = vec_2(20, 2)
    tt.texts.list[1].text = "Hello world"
    tt.texts.list[1].size = vec_2(176, 70)
    tt.texts.list[1].font_name = "body_bold"
    tt.texts.list[1].font_sizes = {24, 23, 18}
    tt.texts.list[1].color = {94, 217, 229}
    tt.texts.list[1].line_height = 0.8
    tt.texts.list[1].sprite_id = 2
    tt.texts.list[1].fit_height = true
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_2(1.01, 1.01)}, {0.4, vec_2(0.99, 0.99)}, {0.8, vec_2(1.01, 1.01)}}
    tt.tween.props[1].sprite_id = 1
    tt.tween.props[1].loop = true
    tt.tween.props[2] = table.deepclone(tt.tween.props[1])
    tt.tween.props[2].sprite_id = 2
    tt.tween.remove = false

    tt = E:register_t("ray_umbra", "bullet")
    tt.image_width = 190
    tt.main_script.update = scripts.ray_enemy.update
    tt.render.sprites[1].name = "ray_umbra"
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].anchor = vec_2(0, 0.5)
    tt.bullet.damage_type = DAMAGE_TRUE
    tt.bullet.damage_min = 100
    tt.bullet.damage_max = 150
    tt.bullet.damage_radius = 64
    tt.bullet.max_track_distance = 50
    tt.bullet.vis_bans = bor(F_ENEMY, F_FLYING)
    tt.bullet.hit_time = fts(7)
    tt.bullet.hit_fx = "fx_ray_umbra_explosion"

    tt = E:register_t("ray_umbra_tower", "ray_umbra")
    tt.bullet.damage_radius = 0
    tt.bullet.damage_type = DAMAGE_NONE
    tt.bullet.hit_fx = nil
    tt.bullet.mod = "mod_umbra"

    tt = E:register_t("fx_ray_umbra_explosion", "fx")
    tt.render.sprites[1].name = "ray_umbra_explosion"

    tt = E:register_t("fx_ray_umbra_explosion_smoke", "fx")
    tt.render.sprites[1].name = "ray_umbra_explosion_smoke"

    tt = E:register_t("fx_umbra_death_blast", "fx")
    tt.render.sprites[1].prefix = "umbra_death_blast"
    tt.render.sprites[1].name = "short"
    tt.render.sprites[1].anchor.y = 0.18

    tt = E:register_t("mod_umbra", "modifier")
    E:add_comps(tt, "render")
    tt.main_script.update = scripts.mod_tower_remove.update
    tt.modifier.hide_time = fts(22)
    tt.render.sprites[1].anchor.y = 0.19
    tt.render.sprites[1].z = Z_OBJECTS + 1
    tt.render.sprites[1].name = "umbra_tower_remove"

    tt = E:register_t("umbra_portal", "decal_scripted")
    E:add_comps(tt, "render", "spawner")
    tt.main_script.update = scripts.umbra_portal.update
    tt.render.sprites[1].prefix = "umbra_portal"
    tt.render.sprites[1].z = Z_DECALS
    tt.spawner.count = 0
    tt.spawner.cycle_time = fts(6)
    tt.spawner.entity = "enemy_umbra_minion"
    tt.spawner.animation_start = "start"
    tt.spawner.animation_loop = "loop"
    tt.spawner.animation_end = "end"
    tt.spawner.ni_var = 3
    tt.spawner.spawn_fx = "fx_umbra_minion_spawn"

    tt = E:register_t("fx_umbra_minion_spawn", "fx")
    tt.render.sprites[1].name = "umbra_minion_spawn"
    tt.render.sprites[1].anchor.y = 0.19

    tt = E:register_t("enemy_umbra_minion", "enemy")
    E:add_comps(tt, "melee")
    anchor_y = 0.19
    image_y = 66
    tt.enemy.gold = 6
    tt.enemy.melee_slot = vec_2(26, 0)
    tt.health.armor = 0
    tt.health.hp_max = 430
    tt.health.magic_armor = 0
    tt.health_bar.offset = vec_2(0, ady(62))
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM
    tt.info.portrait = IS_PHONE and "portraits_sc_0069" or "kr2_info_portraits_enemies_0055"
    tt.info.enc_icon = 41
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.enemy_mixed.update
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 170
    tt.melee.attacks[1].damage_min = 120
    tt.melee.attacks[1].hit_time = fts(12)
    tt.motion.max_speed = 0.967 * FPS
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].name = "idle"
    tt.render.sprites[1].prefix = "enemy_umbra_minion"
    tt.sound_events.death = "DeathPuff"
    tt.unit.can_explode = false
    tt.unit.blood_color = BLOOD_GRAY
    tt.unit.hit_offset = vec_2(0, 16)
    tt.unit.marker_offset = vec_2(0, ady(13))
    tt.unit.mod_offset = vec_2(0, ady(30))
    tt.unit.show_blood_pool = false
    tt.unit.hide_after_death = true
    tt.unit.size = UNIT_SIZE_MEDIUM
    tt.vis.bans = bor(F_SKELETON)

    tt = E:register_t("enemy_umbra_piece", "enemy")
    E:add_comps(tt, "melee", "timed")
    anchor_y = 0.21
    image_y = 70
    tt.enemy.gold = 90
    tt.enemy.melee_slot = vec_2(30, 0)
    tt.health.armor = 0
    tt.health.hp_max = 1000
    tt.health.magic_armor = 0
    tt.health_bar.offset = vec_2(0, ady(59))
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM
    tt.info.portrait = IS_PHONE and "portraits_sc_0069" or "kr2_info_portraits_enemies_0056"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.enemy_umbra_piece.update
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 50
    tt.melee.attacks[1].damage_min = 30
    tt.melee.attacks[1].hit_time = fts(12)
    tt.motion.max_speed = 1.067 * FPS
    tt.motion.max_speed_called = 6.656000000000001 * FPS
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].name = "idle"
    tt.render.sprites[1].prefix = "enemy_umbra_piece"
    tt.sound_events.death = "DeathPuff"
    tt.sound_events.raise = "FrontiersFinalBossPiecesRespawn"
    tt.timed.disabled = true
    tt.ui.click_rect = r(-20, -5, 40, 50)
    tt.unit.blood_color = BLOOD_GRAY
    tt.unit.can_explode = false
    tt.unit.hit_offset = vec_2(0, 24)
    tt.unit.marker_offset = vec_2(0, ady(14))
    tt.unit.mod_offset = vec_2(0, ady(33))
    tt.unit.show_blood_pool = false
    tt.unit.hide_after_death = true
    tt.unit.size = UNIT_SIZE_MEDIUM
    tt.vis.bans = F_ALL
    tt.vis.bans_walking = bor(F_SKELETON, F_EAT, F_POISON, F_TWISTER, F_POLYMORPH, F_TELEPORT)
    tt.piece_respawn_delay = fts(35) + 3
    tt.piece_respawn_delay_repeating = fts(35)

    tt = E:register_t("enemy_umbra_piece_flying", "bomb")
    tt.render.sprites[1].name = "enemy_umbra_piece_flying"
    tt.render.sprites[1].animated = true
    tt.render.sprites[1].loop = false
    tt.bullet.flight_time = fts(20)
    tt.bullet.vis_bans = F_ALL
    tt.bullet.hit_fx = nil
    tt.bullet.hit_decal = nil
    tt.bullet.pop = nil
    tt.bullet.rotation_speed = nil
    tt.bullet.hide_radius = nil
    tt.bullet.align_with_trajectory = true
    tt.sound_events.insert = nil
    tt.sound_events.hit = nil
    tt.sound_events.hit_water = nil

    tt = E:register_t("fx_umbra_white_circle", "decal_tween")
    tt.render.sprites[1].name = "white_explosion"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].z = Z_GUI - 2
    tt.tween.remove = false
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_2(0.3, 0.3)}, {0.6, vec_2(20, 20)}}

    tt = E:register_t("umbra_crystals", "decal_scripted")
    tt.render.sprites[1].prefix = "umbra_crystals"
    tt.render.sprites[1].name = "idle"
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].z = Z_OBJECTS - 1
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].name = "umbra_crystals_crack1"
    tt.render.sprites[2].hidden = true
    tt.render.sprites[2].loop = false
    tt.render.sprites[3] = table.deepclone(tt.render.sprites[2])
    tt.render.sprites[3].name = "umbra_crystals_crack2"
    tt.render.sprites[4] = table.deepclone(tt.render.sprites[2])
    tt.render.sprites[4].name = "umbra_crystals_crack3"
    tt.main_script.update = scripts.decal_umbra_crystals.update

    tt = E:register_t("umbra_crystals_broken", "decal")
    tt.render.sprites[1].name = "finalBoss_spawn_0108"
    tt.render.sprites[1].animated = false

    tt = E:register_t("umbra_crystals_piece", "decal_tween")
    tt.render.sprites[1].name = "umbra_crystals_piece"
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].z = Z_OBJECTS
    tt.tween.props[1].name = "alpha"
    tt.tween.props[1].keys = {{0, 255}, {fts(21), 255}, {fts(21) + 1, 0}}

    tt = E:register_t("umbra_guy", "decal_scripted")
    E:add_comps(tt, "attacks")
    tt.main_script.update = scripts.umbra_guy.update
    tt.render.sprites[1].prefix = "umbra_guy"
    tt.attacks.list[1] = E:clone_c("bullet_attack")
    tt.attacks.list[1].bullet = "ray_umbra_guy"
    tt.attacks.list[1].cooldown = 40
    tt.attacks.list[1].vis_bans = bor(F_FLYING, F_ENEMY)
    tt.attacks.list[1].shoot_time = fts(19)
    tt.attacks.list[1].max_range = 300.16
    tt.attacks.list[1].bullet_start_offset = vec_2(-17, 41)
    tt.taunt = {}
    tt.taunt.cooldown = 20
    tt.taunt.format = "FINAL_BOSS_GUY_TAUNT_%04d"
    tt.taunt.normal_idx = {3, 25}
    tt.taunt.attack_idx = {30, 34}
    tt.taunt.lost_life_idx = {26, 29}
    tt.taunt.normal_pos = vec_2(579, 655)
    tt.taunt.death_pos = vec_2(656, 610)
    tt.taunt.duration = 4
    tt.taunt.attack_duration = 1.25
    tt.taunt.shoutbox = "decal_umbra_guy_shoutbox"
    tt.taunt.ts = 0

    tt = E:register_t("umbra_guy_force_field", "decal_tween")
    tt.render.sprites[1].name = "finalBoss_guy_forceShield_0013"
    tt.render.sprites[1].animated = false
    tt.tween.remove = false
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_2(1, 1)}, {0.25, vec_2(0.92, 0.92)}, {0.5, vec_2(1, 1)}}
    tt.tween.props[1].loop = true

    tt = E:register_t("ray_umbra_guy", "bullet")
    tt.image_width = 238
    tt.main_script.update = scripts.ray_enemy.update
    tt.render.sprites[1].name = "ray_umbra_guy"
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].anchor = vec_2(0, 0.5)
    tt.bullet.damage_type = DAMAGE_TRUE
    tt.bullet.damage_min = 200
    tt.bullet.damage_max = 400
    tt.bullet.damage_radius = 60.160000000000004
    tt.bullet.max_track_distance = 50
    tt.bullet.vis_bans = bor(F_ENEMY, F_FLYING)
    tt.bullet.hit_time = fts(7)
    tt.bullet.hit_fx = "fx_ray_umbra_guy_explosion"
    tt.sound_events.insert = "TeslaAttack"

    tt = E:register_t("fx_ray_umbra_guy_explosion", "fx")
    tt.render.sprites[1].name = "ray_umbra_guy_explosion"

    tt = E:register_t("decal_umbra_guy_shoutbox", "decal_tween")
    E:add_comps(tt, "texts", "timed")
    tt.render.sprites[1].name = "finalBoss_GuyTauntBox"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].z = Z_BULLETS
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].z = Z_BULLETS
    tt.render.sprites[2].offset = vec_2(7, 15)
    tt.texts.list[1].text = "Hello world"
    tt.texts.list[1].size = vec_2(168, 60)
    tt.texts.list[1].font_name = "body_bold"
    tt.texts.list[1].font_size = 20
    tt.texts.list[1].color = {255, 145, 114}
    tt.texts.list[1].line_heights = {0.8, 0.8}
    tt.texts.list[1].sprite_id = 2
    tt.texts.list[1].fit_height = true
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_2(1.01, 1.01)}, {0.4, vec_2(0.99, 0.99)}, {0.8, vec_2(1.01, 1.01)}}
    tt.tween.props[1].sprite_id = 1
    tt.tween.props[1].loop = true
    tt.tween.props[2] = table.deepclone(tt.tween.props[1])
    tt.tween.props[2].sprite_id = 2
    tt.tween.remove = false

    tt = E:register_t("eb_leviathan", "boss")
    E:add_comps(tt, "attacks")
    anchor_y = 0.15254237288135594
    image_y = 118
    tt.attacks.list[1] = E:clone_c("custom_attack")
    tt.attacks.list[1].cooldown = 12
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(50, 0)
    tt.health.dead_lifetime = fts(200)
    tt.health.hp_max = 8500
    tt.health_bar.offset = vec_2(0, ady(120))
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_leviathan.get_info
    tt.info.portrait = IS_PHONE and "portraits_sc_0077" or "kr2_info_portraits_enemies_0060"
    tt.info.enc_icon = 48
    tt.main_script.insert = scripts.eb_leviathan.insert
    tt.main_script.update = scripts.eb_leviathan.update
    tt.motion.max_speed = 0.384 * FPS
    tt.render.sprites[1] = E:clone_c("sprite")
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].prefix = "eb_leviathan_water"
    tt.render.sprites[1].name = "spawn"
    tt.render.sprites[1].loop_forced = true
    tt.render.sprites[1].hidden = true
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].anchor.y = anchor_y
    tt.render.sprites[2].prefix = "eb_leviathan"
    tt.render.sprites[2].name = "spawn"
    tt.ui.click_rect = r(-50, 0, 100, 80)
    tt.unit.blood_color = BLOOD_GREEN
    tt.unit.hide_after_death = true
    tt.unit.hit_offset = vec_2(0, ady(47))
    tt.unit.marker_hidden = true
    tt.unit.mod_offset = vec_2(0, ady(65))
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.unit.hit_rect = r(-58, 0, 116, 78)
    tt.vis.bans = F_ALL
    tt.vis.bans_in_battlefield = bor(F_STUN, F_BLOOD, F_DRILL, F_LETHAL, F_SKELETON, F_POLYMORPH, F_TELEPORT, F_BLOCK)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.sound_events.spawn = "RTBossSpawn"
    tt.sound_events.death = "RTBossDeath"

    tt = E:register_t("leviathan_head", "decal")
    tt.render.sprites[1].prefix = "leviathan_head"
    tt.render.sprites[1].name = "show"
    tt.render.sprites[1].anchor.y = 0.4830508474576271

    tt = E:register_t("leviathan_tentacle", "decal_scripted")
    tt.render.sprites[1].prefix = "leviathan_tentacle"
    tt.render.sprites[1].name = "show"
    tt.render.sprites[1].anchor.y = 0.23076923076923078
    tt.main_script.update = scripts.leviathan_tentacle.update
    tt.tower_bans = {"tower_mech"}
    tt.range = 50
    tt.search_off_x = 90
    tt.duration = 8
    tt.interrupt = nil
    tt.flip = nil

    tt = E:register_t("fx_leviathan_incoming", "decal_tween")
    tt.tween.remove = true
    tt.tween.props[1].name = "alpha"
    tt.tween.props[1].keys = {{0, 0}, {1, 255}, {3, 255}}
    tt.tween.props[2] = E:clone_c("tween_prop")
    tt.tween.props[2].name = "scale"
    tt.tween.props[2].keys = {{0, vec_2(0.35, 0.35)}, {3, vec_2(1, 1)}}
    tt.render.sprites[1].name = "fx_leviathan_bubbles"
    tt.render.sprites[1].z = Z_DECALS + 2
    tt.render.sprites[1].loop = true
    tt.render.sprites[1].anchor.y = 0.15254237288135594

    tt = E:register_t("eb_dracula", "boss")
    E:add_comps(tt, "melee")
    image_y = 80
    anchor_y = 0.1375
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(15, 0)
    tt.health.dead_lifetime = fts(10000)
    tt.health.hp_max = 8475
    tt.health_bar.offset = vec_2(0, 60)
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM
    -- tt.info.fn = scripts.eb_dracula.get_info
    tt.info.portrait = IS_PHONE and "portraits_sc_0090" or "kr2_info_portraits_enemies_0067"
    tt.info.enc_icon = 57
    tt.main_script.insert = scripts.eb_dracula.insert
    tt.main_script.update = scripts.eb_dracula.update
    tt.melee.attacks[1].cooldown = 1
    tt.melee.attacks[1].damage_max = 200
    tt.melee.attacks[1].damage_min = 150
    tt.melee.attacks[1].hit_time = fts(19)
    tt.melee.attacks[2] = E:clone_c("melee_attack")
    tt.melee.attacks[2].mod = "mod_dracula_lifesteal"
    tt.melee.attacks[2].cooldown = 5
    tt.melee.attacks[2].animation = "lifesteal"
    tt.melee.attacks[2].hit_time = fts(6)
    tt.melee.attacks[2].fn_can = scripts.eb_dracula.can_lifesteal
    tt.motion.max_speed = 0.427 * FPS
    tt.motion.max_speed_bat = 2.56 * FPS
    tt.motion.max_speed_default = 0.427 * FPS
    tt.motion.max_speed_angry = 0.747 * FPS
    tt.render.sprites[1] = E:clone_c("sprite")
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].prefix = "eb_dracula"
    tt.ui.click_rect = r(-20, -5, 40, 65)
    tt.unit.can_explode = false
    tt.unit.hit_offset = vec_2(0, 33)
    tt.unit.mod_offset = vec_2(0, ady(33))
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_MEDIUM
    tt.vis.bans = bor(F_SKELETON)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.sound_events.insert = "MusicBossFight"
    tt.sound_events.death = "HWBossVampireDeath"

    tt = E:register_t("mod_dracula_lifesteal", "modifier")
    tt.modifier.duration = fts(50)
    tt.cycle_time = fts(2)
    tt.heal_hp = 25
    tt.damage = 150
    tt.main_script.update = scripts.mod_dracula_lifesteal.update
    tt.sound_events.insert = "HWBossVampireLifesteal"

    tt = E:register_t("dracula_damage_aura", "aura")
    E:add_comps(tt, "render")
    tt.aura.cycle_time = fts(2)
    tt.aura.duration = -1
    tt.aura.radius = 128
    tt.aura.dist_factor_min_radius = 38.4
    tt.aura.vis_bans = bor(F_ENEMY, F_BOSS)
    tt.aura.vis_flags = F_MOD
    tt.aura.dps_min = 3 * FPS
    tt.aura.dps_max = 18 * FPS
    tt.aura.damage_type = DAMAGE_TRUE
    tt.aura.hero_damage_factor = 0.5555555555555556
    tt.main_script.update = scripts.dracula_damage_aura.update
    tt.render.sprites[1].name = "dracula_damage_aura"
    tt.render.sprites[1].loop = true
    tt.render.sprites[1].anchor = vec_2(0.5289855072463768, 0.48484848484848486)
    tt.render.sprites[1].z = Z_DECALS

    tt = E:register_t("eb_saurian_king", "boss")
    E:add_comps(tt, "melee", "timed_attacks")
    image_y = 150
    anchor_y = 0.16666666666666666
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(25, 0)
    tt.health.armor = 0.5
    tt.health.dead_lifetime = fts(200)
    tt.health.hp_max = 11000
    tt.health_bar.offset = vec_2(0, 103)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.fn = scripts.eb_saurian_king.get_info
    tt.info.portrait = IS_PHONE and "portraits_sc_0096" or "kr2_info_portraits_enemies_0042"
    tt.info.enc_icon = 60
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_saurian_king.update
    tt.motion.max_speed = 1.494 * FPS
    tt.render.sprites[1] = E:clone_c("sprite")
    tt.render.sprites[1].anchor.y = anchor_y
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].prefix = "eb_saurian_king"
    tt.ui.click_rect = r(-35, 0, 70, 80)
    tt.unit.can_explode = false
    tt.unit.hit_offset = vec_2(0, 45)
    tt.unit.mod_offset = vec_2(0, 45)
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_SKELETON)
    tt.vis.flags = bor(F_ENEMY, F_BOSS)
    tt.sound_events.insert = "MusicBossFight"
    tt.sound_events.death = "SaurianKingBossDeath"
    tt.melee.attacks[1] = E:clone_c("area_attack")
    tt.melee.attacks[1].cooldown = 2
    tt.melee.attacks[1].damage_max = 0
    tt.melee.attacks[1].damage_min = 0
    tt.melee.attacks[1].damage_radius = 25
    tt.melee.attacks[1].hit_time = fts(6)
    tt.melee.attacks[1].hit_offset = tt.enemy.melee_slot
    tt.melee.attacks[1].mod = "mod_saurian_king_tongue"
    tt.melee.attacks[1].sound = "SaurianKingBossTongue"
    tt.timed_attacks.list[1] = E:clone_c("custom_attack")
    tt.timed_attacks.list[1].animations = {"hammer_start", "hammer_loop"}
    tt.timed_attacks.list[1].cooldown = 5
    tt.timed_attacks.list[1].damage_radius = 500
    tt.timed_attacks.list[1].damage_type = DAMAGE_EXPLOSION
    tt.timed_attacks.list[1].hit_times = {fts(11), fts(18)}
    tt.timed_attacks.list[1].max_damage_radius = 50
    tt.timed_attacks.list[1].max_damages = {10, 15, 25, 40, 65, 100, 145, 200}
    tt.timed_attacks.list[1].vis_bans = bor(F_FLYING)
    tt.timed_attacks.list[1].min_damages = {5, 7, 12, 20, 30, 50, 70, 100}
    tt.timed_attacks.list[1].sound = "SaurianKingBossHammer"
    tt.timed_attacks.list[1].vis_flags = F_RANGED
    tt.timed_attacks.list[1].fx_offsets = {vec_2(48, -11), vec_2(62, 1)}

    tt = E:register_t("decal_saurian_king_hammer", "fx")
    tt.render.sprites[1].name = "decal_saurian_king_hammer"
    tt.render.sprites[1].z = Z_DECALS

    tt = E:register_t("mod_saurian_king_tongue", "modifier")
    tt.main_script.insert = scripts.mod_saurian_king_tongue.insert
    tt.modifier.damage_radius = 25
    tt.modifier.damage_max = 150
    tt.modifier.damage_min = 100
    tt.modifier.vis_flags = F_MOD
    tt.modifier.vis_bans = bor(F_ENEMY, F_FLYING)

    tt = E:register_t("eb_gnoll", "boss")
    E:add_comps(tt, "melee", "timed_attacks", "auras")
    tt.auras.list[1] = E:clone_c("aura_attack")
    tt.auras.list[1].name = "gnoll_boss_aura"
    tt.auras.list[1].cooldown = 0
    tt.enemy.gold = 1
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.armor = 0.6
    tt.health.dead_lifetime = 100
    tt.health.hp_max = 8000
    tt.health_bar.offset = vec_2(0, 100)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.enc_icon = 26
    tt.info.i18n_key = "EB_GNOLL"
    tt.info.portrait = "kr3_portraits_sc_0013"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_gnoll.update
    tt.motion.max_speed = 0.83 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.2948717948717949)
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].prefix = "eb_gnoll"
    tt.sound_events.death = "ElvesHyenaDeath"
    tt.ui.click_rect = r(-35, 0, 70, 80)
    tt.unit.can_explode = false
    tt.unit.hit_offset = vec_2(0, 50)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 40)
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_SKELETON, F_POLYMORPH)
    tt.melee.attacks[1].cooldown = 1.5
    tt.melee.attacks[1].damage_max = 90
    tt.melee.attacks[1].damage_min = 70
    tt.melee.attacks[1].hit_time = fts(22)
    tt.melee.attacks[1].uninterruptible = true
    tt.timed_attacks.list[1] = E:clone_c("custom_attack")
    tt.timed_attacks.list[1].cooldown = {7, 7, 7, 5}
    tt.timed_attacks.list[1].hit_time = fts(55)
    tt.timed_attacks.list[1].animation = "specialAttack"
    tt.timed_attacks.list[1].min_range = 0
    tt.timed_attacks.list[1].max_range = 9e+99
    tt.timed_attacks.list[1].damage_max = {180, 180, 180, 1000}
    tt.timed_attacks.list[1].damage_min = 150
    tt.timed_attacks.list[1].damage_max_hero = 120
    tt.timed_attacks.list[1].damage_min_hero = 100
    tt.timed_attacks.list[1].damage_type = bor(DAMAGE_PHYSICAL, DAMAGE_NO_DODGE)
    tt.timed_attacks.list[1].sound = "ElvesHyenaStomp"
    tt.timed_attacks.list[2] = E:clone_c("custom_attack")
    tt.timed_attacks.list[2].animation = "scream"
    tt.timed_attacks.list[2].nis = {85, 135, 180}
    tt.timed_attacks.list[2].wave_names = {"Boss_Path_1", "Boss_Path_2", "Boss_Path_3", "Boss_Path_4"}
    tt.timed_attacks.list[2].hit_time = fts(8)
    tt.timed_attacks.list[2].sound = "ElvesHyenaGrowl"

    tt = E:register_t("gnoll_boss_aura", "aura")
    E:add_comps(tt, "render", "tween")
    tt.aura.cycle_time = fts(5)
    tt.aura.duration = -1
    tt.aura.filter_source = true
    tt.aura.mod = "mod_gnoll_boss"
    tt.aura.radius = 150
    tt.aura.track_source = true
    tt.aura.vis_bans = bor(F_FRIEND)
    tt.aura.vis_flags = F_MOD
    tt.main_script.insert = scripts.aura_apply_mod.insert
    tt.main_script.update = scripts.aura_apply_mod.update
    tt.render.sprites[1].name = "bossHiena_aura_base"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].z = Z_DECALS
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].name = "bossHiena_aura_ring"
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].z = Z_DECALS
    tt.tween.remove = false
    tt.tween.props[1].keys = {{0, 102}, {fts(9), 173}, {fts(21), 20}, {fts(30), 20}}
    tt.tween.props[1].sprite_id = 2
    tt.tween.props[1].loop = true
    tt.tween.props[2] = E:clone_c("tween_prop")
    tt.tween.props[2].keys = {{0, vec_2(0.65, 0.65)}, {fts(30), vec_2(1.57, 1.57)}}
    tt.tween.props[2].name = "scale"
    tt.tween.props[2].sprite_id = 2
    tt.tween.props[2].loop = true

    tt = E:register_t("mod_gnoll_boss", "modifier")
    E:add_comps(tt, "render")
    tt.render.sprites[1].name = "bossHiena_creepFx"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].z = Z_DECALS
    tt.main_script.insert = scripts.mod_gnoll_boss.insert
    tt.main_script.remove = scripts.mod_gnoll_boss.remove
    tt.main_script.update = scripts.mod_track_target.update
    tt.modifier.duration = fts(6)
    tt.modifier.use_mod_offset = false
    tt.extra_health_factor = 0.5
    tt.inflicted_damage_factor = 1.5

    tt = E:register_t("eb_drow_queen", "boss")
    E:add_comps(tt, "melee", "taunts", "tween")
    tt.info.enc_icon = 27
    tt.info.i18n_key = "EB_DROW_QUEEN"
    tt.info.portrait = "kr3_portraits_sc_0062"
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(25, 0)
    tt.health.hp_max = {6000, 9000, 12000, 13500}
    tt.health.hp_max_rounds = {{6000, 4000, 2000}, {9000, 6000, 3000}, {12000, 9000, 5000}, {13500, 10000, 5500}}
    tt.health.on_damage = scripts.eb_drow_queen.on_damage
    tt.health.dead_lifetime = 100
    tt.health_bar.hidden = true
    tt.health_bar.offset = vec_2(0, 49)
    tt.health_bar.sort_y_offset = -2
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM
    tt.main_script.update = scripts.eb_drow_queen.update
    tt.melee.attacks[1] = E:clone_c("area_attack")
    tt.melee.attacks[1].cooldown = 1.2
    tt.melee.attacks[1].damage_radius = 30
    tt.melee.attacks[1].damage_max = {120, 120, 120, 500}
    tt.melee.attacks[1].damage_min = 120
    tt.melee.attacks[1].damage_type = bor(DAMAGE_MAGICAL, DAMAGE_NO_DODGE)
    tt.melee.attacks[1].hit_offset = vec_2(29, 0)
    tt.melee.attacks[1].hit_time = fts(24)
    tt.melee.attacks[1].uninterruptible = true
    tt.motion.max_speed = 0.913 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.15384615384615385)
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walk"}
    tt.render.sprites[1].prefix = "s11_malicia"
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].name = "malicia_glow_0001"
    tt.render.sprites[2].anchor.y = 0.058823529411764705
    tt.render.sprites[2].draw_order = 2
    tt.render.sprites[2].alpha = 0
    tt.render.sprites[3] = E:clone_c("sprite")
    tt.render.sprites[3].animated = false
    tt.render.sprites[3].name = "malicia_glow_0002"
    tt.render.sprites[3].anchor.y = 0.058823529411764705
    tt.render.sprites[3].draw_order = -2
    tt.render.sprites[3].alpha = 0
    tt.sound_events.death = "ElvesMaliciaDeath"
    tt.tween.remove = false
    tt.tween.disabled = true
    tt.tween.props[1].keys = {{0, 255}, {fts(16), 0}}
    tt.tween.props[1].disabled = true
    tt.tween.props[2] = E:clone_c("tween_prop")
    tt.tween.props[2].keys = {{0, 255}, {0.3, 0}}
    tt.tween.props[2].sprite_id = 2
    tt.tween.props[3] = table.deepclone(tt.tween.props[2])
    tt.tween.props[3].sprite_id = 3
    tt.ui.click_rect = r(-20, 0, 40, 50)
    tt.ui.click_rect_default = r(-20, 0, 40, 50)
    tt.ui.click_rect_sitting = r(20, 0, 40, 50)
    tt.unit.hit_offset = vec_2(0, 17)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 17)
    tt.vis.flags = bor(tt.vis.flags, F_DARK_ELF, F_SPELLCASTER)
    tt.vis.bans = bor(F_BLOCK, F_RANGED, F_MOD, F_TELEPORT)
    tt.fly_speed_normal = 5 * FPS
    tt.fly_speed_fight = 3 * FPS
    tt.fly_speed_return = 7 * FPS
    tt.fly_speed_return_die = 9 * FPS
    tt.fly_loop_time = 7 / FPS
    tt.fly_offset_y = 26
    tt.pos_fighting = vec_2(347, 396)
    tt.pos_casting = vec_2(684, 404)
    tt.pos_sitting = vec_2(924, 416)
    tt.tower_block_sets = {{"12", "13", "14"}, {"12", "13", "14", "6"}, {"12", "13", "14", "6", "9", "5"},
                           {"12", "13", "14", "6", "9", "5"}}
    tt.power_block_duration = {8, 8, 8, 15}
    tt.taunts.delay_min = 15
    tt.taunts.delay_max = 20
    tt.taunts.duration = 4
    tt.taunts.sets = {
        welcome = {},
        prebattle = {},
        casting = {},
        sitting = {}
    }
    tt.taunts.sets.welcome.format = "EB_DROW_QUEEN_TAUNT_KIND_WELCOME_%04d"
    tt.taunts.sets.welcome.start_idx = 1
    tt.taunts.sets.welcome.end_idx = 2
    tt.taunts.sets.prebattle.format = "EB_DROW_QUEEN_TAUNT_KIND_PREBATTLE_%04d"
    tt.taunts.sets.prebattle.start_idx = 1
    tt.taunts.sets.prebattle.end_idx = 3
    tt.taunts.sets.casting.format = "EB_DROW_QUEEN_TAUNT_KIND_CASTING_%04d"
    tt.taunts.sets.casting.start_idx = 1
    tt.taunts.sets.casting.end_idx = 4
    tt.taunts.sets.casting.pos = vec_2(791, 348)
    tt.taunts.sets.casting.decal_name = "decal_drow_queen_shoutbox_casting"
    tt.taunts.sets.sitting.format = "EB_DROW_QUEEN_TAUNT_KIND_SITTING_%04d"
    tt.taunts.sets.sitting.start_idx = 1
    tt.taunts.sets.sitting.end_idx = 5
    tt.taunts.decal_name = "decal_drow_queen_shoutbox"
    tt.taunts.offset = vec_2(0, 0)
    tt.taunts.pos = vec_2(870, 376)

    tt = E:register_t("decal_drow_queen_shoutbox", "decal_tween")
    E:add_comps(tt, "texts")
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].name = "malicia_taunt_0001"
    tt.render.sprites[1].z = Z_BULLETS
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].name = "malicia_taunt_0002"
    tt.render.sprites[2].z = Z_BULLETS
    tt.render.sprites[3] = E:clone_c("sprite")
    tt.render.sprites[3].animated = false
    tt.render.sprites[3].z = Z_BULLETS
    tt.render.sprites[3].offset = vec_2(0, 1)
    tt.texts.list[1].text = "Hello world"
    tt.texts.list[1].size = vec_2(180, 58)
    tt.texts.list[1].font_name = "taunts"
    tt.texts.list[1].font_size = 20
    tt.texts.list[1].color = {233, 189, 255}
    tt.texts.list[1].line_height = i18n:cjk(0.8, 0.9, 1.1, 0.7)
    tt.texts.list[1].sprite_id = 3
    tt.texts.list[1].fit_height = true
    tt.tween.props[1].keys = {{0, 0}, {0.25, 255}, {"this.duration-0.25", 255}, {"this.duration", 0}}
    tt.tween.props[1].sprite_id = 1
    tt.tween.props[2] = table.deepclone(tt.tween.props[1])
    tt.tween.props[2].sprite_id = 2
    tt.tween.props[3] = table.deepclone(tt.tween.props[1])
    tt.tween.props[3].sprite_id = 3
    tt.tween.props[4] = E:clone_c("tween_prop")
    tt.tween.props[4].name = "scale"
    tt.tween.props[4].keys = {{0, vec_2(1.01, 1.01)}, {0.4, vec_2(0.99, 0.99)}, {0.8, vec_2(1.01, 1.01)}}
    tt.tween.props[4].sprite_id = 1
    tt.tween.props[4].loop = true
    tt.tween.props[5] = table.deepclone(tt.tween.props[4])
    tt.tween.props[5].sprite_id = 2
    tt.tween.props[6] = table.deepclone(tt.tween.props[4])
    tt.tween.props[6].sprite_id = 3
    tt.tween.remove = true
    tt = E:register_t("decal_drow_queen_shoutbox_casting", "decal_drow_queen_shoutbox")
    tt.render.sprites[2].name = "malicia_taunt_0003"
    tt = E:register_t("decal_drow_queen_flying", "decal")
    tt.render.sprites[1].name = "s11_malicia_teleportLoop"
    tt.render.sprites[1].anchor.y = 0.35384615384615387
    tt.render.sprites[1].hidden = true
    tt.render.sprites[1].sort_y_offset = -24

    tt = E:register_t("decal_drow_queen_shield", "decal_scripted")
    E:add_comps(tt, "tween", "health_bar", "health")
    tt.health.hp = 0
    tt.health_bar.hidden = true
    tt.health_bar.offset = vec_2(0, 52)
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM
    tt.health_bar.colors = {}
    tt.health_bar.colors.fg = {255, 65, 240, 255}
    tt.health_bar.colors.bg = {51, 18, 53, 255}
    tt.health_bar.sort_y_offset = -2
    tt.health.ignore_damage = true
    tt.main_script.update = scripts.decal_drow_queen_shield.update
    tt.render.sprites[1].name = "s11_malicia_shield_idle"
    tt.render.sprites[1].anchor.y = 0.15384615384615385
    tt.render.sprites[1].offset = vec_2(-5, 0)
    tt.render.sprites[1].alpha = 0
    tt.render.sprites[1].sort_y_offset = -1
    tt.tween.remove = false
    tt.tween.disabled = true
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_1(1)}, {fts(10), vec_1(1.1)}, {fts(20), vec_1(1)}}
    tt.tween.props[1].loop = true
    tt.tween.props[1].ignore_reverse = true
    tt.tween.props[2] = E:clone_c("tween_prop")
    tt.tween.props[2].keys = {{0, 0}, {fts(11), 153}}
    tt.shield_hp = 0

    tt = E:register_t("fx_drow_queen_shield_break", "fx")
    E:add_comps(tt, "sound_events")
    tt.render.sprites[1].name = "s11_malicia_shield_break"
    tt.render.sprites[1].anchor.y = 0.15384615384615385
    tt.render.sprites[1].offset.x = -5
    tt.sound_events.insert = "ElvesMaliciaShieldBreak"

    tt = E:register_t("fx_drow_queen_cast", "fx")
    tt.render.sprites[1].name = "s11_malicia_castFx"
    tt.render.sprites[1].anchor.y = 0.15384615384615385

    tt = E:register_t("mod_drow_queen_tower_block", "modifier")
    E:add_comps(tt, "render", "tween")
    tt.main_script.update = scripts.mod_tower_block.update
    tt.modifier.duration = 8
    tt.render.sprites[1].anchor.y = 0.2
    tt.render.sprites[1].draw_order = 10
    tt.render.sprites[1].sort_y_offset = -2
    tt.render.sprites[1].z = Z_OBJECTS
    tt.render.sprites[1].name = "start"
    tt.render.sprites[1].prefix = "malicia_tower_block"
    tt.render.sprites[2] = E:clone_c("sprite")
    tt.render.sprites[2].name = "malicia_towerNet_decal"
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].z = Z_DECALS
    tt.tween.remove = false
    tt.tween.props[1].keys = {{0, 255}, {fts(8), 204}, {fts(16), 255}}
    tt.tween.props[1].loop = true
    tt.tween.props[2] = table.deepclone(tt.tween.props[1])
    tt.tween.props[2].name = "scale"
    tt.tween.props[2].keys = {{0, vec_1(1)}, {fts(8), vec_1(1.015)}, {fts(16), vec_1(1)}}
    tt.tween.props[3] = table.deepclone(tt.tween.props[1])
    tt.tween.props[3].sprite_id = 2
    tt.tween.props[4] = table.deepclone(tt.tween.props[2])
    tt.tween.props[4].sprite_id = 2

    tt = RT("eb_spider", "boss")
    AC(tt, "ranged", "timed_attacks", "taunts")
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(53, 0)
    tt.health.dead_lifetime = 100
    tt.health.hp_max = {12000, 15000, 19000, 21000}
    tt.health.hp_max_rounds = {{12000, 9000, 6000, 3000}, {15000, 11000, 7000, 3000}, {19000, 14000, 10000, 6000},
                               {21000, 16000, 12000, 7000}}
    tt.health.magic_armor = 0.5
    tt.health_bar.offset = vec_2(0, 106)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.enc_icon = 33
    tt.info.portrait = "kr3_portraits_sc_0067"
    tt.info.i18n_key = "EB_SPIDER"
    tt.info.fn = scripts.eb_spider.get_info
    tt.main_script.update = scripts.eb_spider.update
    tt.motion.max_speed = 0.83 * FPS

    for i = 1, 6 do
        local s = E:clone_c("sprite")

        s.prefix = "eb_spider_layer" .. i
        s.name = "idle"
        s.anchor.y = 0.3
        s.angles = {}
        s.angles.walk = {"walkingRightLeft", "walkingDown", "walkingDown"}
        tt.render.sprites[i] = s
    end

    tt.sound_events.death = "ElvesFinalBossDeath"
    tt.ui.click_rect = r(-40, 0, 80, 80)
    tt.unit.hit_offset = vec_2(0, 38)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 38)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.flags = bor(tt.vis.flags, F_DARK_ELF)
    tt.vis.bans = bor(tt.vis.bans, F_STUN)
    tt.taunts.decal_name = "decal_eb_spider_shoutbox"
    tt.taunts.duration = 2
    tt.taunts.offset = vec_2(130, 120)
    tt.taunts.sets = {
        intro = CC("taunt_set"),
        death = CC("taunt_set")
    }
    tt.taunts.sets.intro.format = "EB_SPIDER_TAUNT_KIND_OURS"
    tt.taunts.sets.death.format = "EB_SPIDER_DEATH_TAUNT"
    tt.ranged.attacks[1].bullet = "ray_eb_spider"
    tt.ranged.attacks[1].cooldown = 0.5 + fts(29)
    tt.ranged.attacks[1].animation = "attack"
    tt.ranged.attacks[1].shoot_time = fts(13)
    tt.ranged.attacks[1].bullet_start_offset = {vec_2(24, 101)}
    tt.ranged.attacks[1].ignore_hit_offset = true
    tt.timed_attacks.list[1] = table.deepclone(tt.ranged.attacks[1])
    tt.timed_attacks.list[1].cooldown = {7, 7, 6}
    tt.timed_attacks.list[1].min_range = 30
    tt.timed_attacks.list[1].max_range = 225
    tt.timed_attacks.list[1].shoot_time = fts(13)
    tt.timed_attacks.list[2] = CC("custom_attack")
    tt.timed_attacks.list[2].cooldown = {8, 8, 7}
    tt.timed_attacks.list[2].animation = "blockTower"
    tt.timed_attacks.list[2].hit_time = fts(13)
    tt.timed_attacks.list[2].power_block_duration = 5
    tt.timed_attacks.list[2].hit_sound = "ElvesFinalBossCastSpell"
    tt.timed_attacks.list[2].tower_count = {1, 2, 3, 3}
    tt.timed_attacks.list[2].mod = "mod_eb_spider_tower_block"
    tt.timed_attacks.list[3] = CC("bullet_attack")
    tt.timed_attacks.list[3].bullet = "ray_eb_spider_tower"
    tt.timed_attacks.list[3].max_range = 200
    tt.timed_attacks.list[3].excluded_templates = {"tower_drow"}
    tt.timed_attacks.list[3].shoot_time = fts(8)
    tt.timed_attacks.list[3].animations = {"shootTower_start", "shootTower_loop", "shootTower_end"}
    tt.timed_attacks.list[3].sound = "ElvesFinalBossSpiderSuperrayCharge"
    tt.timed_attacks.list[3].bullet_start_offset = {vec_2(19, 42)}

    tt = RT("ray_eb_spider", "bullet")
    tt.bullet.damage_max = 120
    tt.bullet.damage_min = 80
    tt.bullet.damage_radius = 45
    tt.bullet.damage_type = bor(DAMAGE_TRUE, DAMAGE_NO_DODGE)
    tt.bullet.hit_fx = "fx_ray_eb_spider_explosion"
    tt.bullet.hit_time = fts(5)
    tt.bullet.ignore_hit_offset = true
    tt.bullet.vis_bans = bor(F_ENEMY)
    tt.image_width = 248
    tt.main_script.update = scripts.ray_enemy.update
    tt.render.sprites[1].anchor = vec_2(0, 0.5)
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].name = "ray_eb_spider"
    tt.sound_events.insert = "ElvesFinalBosskillray"

    tt = RT("ray_eb_spider_tower", "ray_eb_spider")
    tt.bullet.damage_radius = 0
    tt.bullet.damage_type = DAMAGE_NONE
    tt.bullet.hit_fx = nil
    tt.bullet.mod = "mod_eb_spider_tower_remove"
    tt.image_width = 230
    tt.render.sprites[1].name = "ray_eb_spider_tower"
    tt.sound_events.insert = "ElvesFinalBossSpiderSuperrayDischarge"

    tt = RT("mod_eb_spider_tower_block", "mod_drow_queen_tower_block")
    tt.modifier.duration = 5
    tt.render.sprites[1].prefix = "eb_spider_tower_block"
    tt.render.sprites[2].name = "spiderQueen_towerNet_decal"

    tt = RT("mod_eb_spider_tower_remove", "modifier")
    AC(tt, "render", "tween")
    tt.main_script.update = scripts.mod_tower_remove.update
    tt.modifier.hide_time = fts(27)
    tt.render.sprites[1].name = "mod_eb_spider_tower_remove_explosion"
    tt.render.sprites[1].anchor.y = 0.375
    tt.render.sprites[1].z = Z_OBJECTS + 1
    tt.render.sprites[2] = CC("sprite")
    tt.render.sprites[2].name = "spiderQueen_towerExplosion_ring"
    tt.render.sprites[2].animated = false
    tt.render.sprites[2].z = Z_DECALS
    tt.tween.remove = false
    tt.tween.props[1].keys = {{fts(23), 0}, {fts(24), 255}, {fts(28), 255}, {fts(35), 0}}
    tt.tween.props[1].sprite_id = 2
    tt.tween.props[2] = CC("tween_prop")
    tt.tween.props[2].name = "scale"
    tt.tween.props[2].keys = {{fts(24), vec_1(0.24)}, {fts(28), vec_1(1)}, {fts(35), vec_1(1.2)}}
    tt.tween.props[2].sprite_id = 2
    tt = RT("fx_ray_eb_spider_explosion", "fx")
    tt.render.sprites[1].name = "fx_ray_eb_spider_explosion"
    tt.render.sprites[2] = CC("sprite")
    tt.render.sprites[2].name = "fx_ray_eb_spider_decal"
    tt.render.sprites[2].loop = false
    tt.render.sprites[2].z = Z_DECALS
    tt = RT("fx_eb_spider_spawn", "decal_tween")
    tt.render.sprites[1].name = "fx_eb_spider_spawn"
    tt.render.sprites[1].offset.y = 43
    tt.tween.disabled = true
    tt.tween.props[1].keys = {{fts(0), 255}, {fts(5), 0}}
    tt = RT("fx_eb_spider_jump_smoke", "fx")
    tt.render.sprites[1].name = "fx_eb_spider_jump_smoke"
    tt.render.sprites[1].anchor.y = 0.12
    tt = RT("decal_shadow_eb_spider", "decal_tween")
    tt.render.sprites[1].name = "spiderQueen_shadow"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].anchor.y = 0.31153846153846154
    tt.tween.remove = false
    tt.tween.props[1].keys = {{0, 0}, {0.55, 255}, {0.6, 255}}
    tt.tween.props[2] = CC("tween_prop")
    tt.tween.props[2].keys = {{0, vec_1(0)}, {0.55, vec_1(1)}, {0.6, vec_1(1)}}
    tt.tween.props[2].name = "scale"
    tt = RT("decal_eb_spider_death_second_rays", "decal_tween")
    tt.tween.remove = false

    local angles = {32, -48, 118, -128}

    for i = 1, 4 do
        tt.render.sprites[i] = CC("sprite")
        tt.render.sprites[i].name = "spiderQueen_deathShapes_0001"
        tt.render.sprites[i].animated = false
        tt.render.sprites[i].r = d2r(angles[i])
        tt.render.sprites[i].z = Z_OBJECTS + 1

        local d = (i - 1) * 9 + (i == 4 and 2 or 0)

        tt.tween.props[2 * i - 1] = CC("tween_prop")
        tt.tween.props[2 * i - 1].name = "scale"
        tt.tween.props[2 * i - 1].keys = {{fts(0), vec_2(1, 1.25)}, {fts(2), vec_1(0.75)}, {fts(4), vec_2(1, 1.25)}}
        tt.tween.props[2 * i - 1].sprite_id = i
        tt.tween.props[2 * i - 1].time_offset = fts(i - 1)
        tt.tween.props[2 * i - 1].loop = true
        tt.tween.props[2 * i] = CC("tween_prop")
        tt.tween.props[2 * i].name = "scale"
        tt.tween.props[2 * i].keys = {{fts(d), vec_1(0)}, {fts(d + 2), vec_1(0.4)}, {fts(d + 3), vec_1(1)}}
        tt.tween.props[2 * i].sprite_id = i
        tt.tween.props[2 * i].multiply = true
    end

    tt.render.sprites[5] = CC("sprite")
    tt.render.sprites[5].name = "spiderQueen_deathShapes_0002"
    tt.render.sprites[5].animated = false
    tt.render.sprites[5].z = Z_OBJECTS + 1
    tt.tween.props[9] = CC("tween_prop")
    tt.tween.props[9].name = "scale"
    tt.tween.props[9].keys = {{0, vec_1(0.8)}, {fts(2), vec_1(1)}, {fts(4), vec_1(0.8)}}
    tt.tween.props[9].loop = true
    tt.tween.props[9].sprite_id = 5
    tt = RT("decal_eb_spider_death_white_circle", "decal_tween")
    tt.render.sprites[1].name = "spiderQueen_deathShapes_0002"
    tt.render.sprites[1].animated = false
    tt.render.sprites[1].loop = false
    tt.render.sprites[1].z = Z_GUI - 2
    tt.tween.remove = false
    tt.tween.props[1].name = "scale"
    tt.tween.props[1].keys = {{0, vec_1(1.5)}, {fts(7), vec_1(60)}}
    tt = RT("decal_eb_spider_shoutbox", "decal_drow_queen_shoutbox")
    tt.render.sprites[1].name = "stage15_taunts_0001"
    tt.render.sprites[2].name = "stage15_taunts_0003"
    tt.render.sprites[3].offset = vec_2(13, -13)
    tt.texts.list[1].font_size = i18n:cjk(28, nil, 22, nil)
    tt.texts.list[1].size = vec_2(158, 56)
    tt.texts.list[1].fit_height = true

    tt = RT("eb_bram", "boss")
    AC(tt, "melee", "timed_attacks", "taunts")
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(40, 0)
    tt.health.dead_lifetime = 100
    tt.health.hp_max = 11000
    tt.health_bar.offset = vec_2(0, 98)
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM_LARGE
    tt.health_bar.hidden = true
    tt.info.enc_icon = 38
    tt.info.portrait = "kr3_portraits_sc_0072"
    tt.info.i18n_key = "EB_BRAM"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_bram.update
    tt.motion.max_speed = 1 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.24691358024691357)
    tt.render.sprites[1].prefix = "eb_bram"
    tt.render.sprites[1].name = "sitting"
    tt.render.sprites[1].flip_x = true
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingDown", "walkingDown"}
    tt.render.sprites[1].angles_custom = {
        walk = {45, 120, 240, 315}
    }
    tt.render.sprites[1].angles_stickiness = {
        walk = 10
    }
    tt.sound_events.death = "ElvesBossBramDeath"
    tt.unit.click_rect = r(-35, 0, 70, 65)
    tt.unit.hit_offset = vec_2(0, 50)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 45)
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.flags = bor(tt.vis.flags)
    tt.vis.bans = bor(F_SKELETON, F_POLYMORPH)
    tt.pos_sitting = vec_2(716, 584)
    tt.nav_path.pi = 7
    tt.nav_path.spi = 1
    tt.nav_path.ni = 1
    tt.spawn_at_nodes = {15, 40, 70}
    tt.spawn_wave_names = {"Boss_Path_1", "Boss_Path_2", "Boss_Path_3", "Boss_Path_4"}
    tt.melee.cooldown = 1.5
    tt.melee.attacks[1].animation = "attack"
    tt.melee.attacks[1].damage_max = {150, 150, 150, 250}
    tt.melee.attacks[1].damage_min = {100, 100, 100, 200}
    tt.melee.attacks[1].hit_time = fts(11)
    tt.melee.attacks[1].shared_cooldown = true
    tt.melee.attacks[1].fn_can = function(t, s, a, target)
        return band(target.vis.flags, F_HERO) ~= 0
    end
    tt.melee.attacks[2] = E:clone_c("melee_attack")
    tt.melee.attacks[2].animation = "attack"
    tt.melee.attacks[2].damage_type = bor(DAMAGE_NONE, DAMAGE_NO_DODGE)
    tt.melee.attacks[2].hit_time = fts(11)
    tt.melee.attacks[2].mod = "mod_bram_slap"
    tt.melee.attacks[2].shared_cooldown = true
    tt.melee.attacks[2].sound_hit = "ElvesBossBramSlap"
    tt.melee.attacks[2].fn_can = function(t, s, a, target)
        return band(target.vis.flags, F_HERO) == 0
    end
    tt.melee.attacks[2].vis_flags = bor(F_BLOCK, F_EAT, F_INSTAKILL)
    tt.timed_attacks.list[1] = CC("mod_attack")
    tt.timed_attacks.list[1].allowed_templates = {"enemy_gnoll_burner", "enemy_gnoll_reaver"}
    tt.timed_attacks.list[1].mod = "mod_bloodsydian_warlock"
    tt.timed_attacks.list[1].animation = "special"
    tt.timed_attacks.list[1].cast_time = fts(18)
    tt.timed_attacks.list[1].hit_decal = "decal_bloodsydian_warlock"
    tt.timed_attacks.list[1].cooldown = {7, 7, 7, 5}
    tt.timed_attacks.list[1].max_range = 150
    tt.timed_attacks.list[1].max_count = 10
    tt.timed_attacks.list[1].min_count = 3
    tt.timed_attacks.list[1].nodes_limit = 0
    tt.timed_attacks.list[1].vis_flags = bor(F_RANGED, F_MOD)
    tt.timed_attacks.list[1].sound = "ElvesBossBramGroundStomp"
    tt.taunts.delay_min = 15
    tt.taunts.delay_max = 20
    tt.taunts.duration = 3.7
    tt.taunts.decal_name = "decal_s18_shoutbox"
    tt.taunts.offset = vec_2(0, 0)
    tt.taunts.pos = vec_2(736, 719)
    tt.taunts.sets.welcome = CC("taunt_set")
    tt.taunts.sets.welcome.format = "BOSS_BRAM_TAUNT_WELCOME_%04d"
    tt.taunts.sets.welcome.end_idx = 2
    tt.taunts.sets.sitting = CC("taunt_set")
    tt.taunts.sets.sitting.format = "BOSS_BRAM_TAUNT_GENERIC_%04d"
    tt.taunts.sets.sitting.end_idx = 5
    tt.taunts.sets.prebattle = CC("taunt_set")
    tt.taunts.sets.prebattle.format = "BOSS_BRAM_TAUNT_PREBATTLE_%04d"
    tt.taunts.sets.prebattle.end_idx = 3

    tt = E:register_t("mod_bram_slap", "modifier")
    tt.main_script.queue = scripts.mod_bram_slap.queue
    tt.main_script.update = scripts.mod_bram_slap.update
    tt.custom_anchors = {}
    tt.custom_anchors.default = vec_2(0.5, 0.45)

    tt = E:register_t("decal_bram_enemy_clone", "decal_bravebark_branchball_enemy_clone")

    tt = RT("eb_bajnimen", "boss")
    AC(tt, "melee", "ranged", "timed_attacks")
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(60, 0)
    tt.health.dead_lifetime = 100
    tt.health.armor = 0.2
    tt.health.magic_armor = {0, 0, 0.5, 0.5}
    tt.health.hp_max = 10000
    tt.health.on_damage = scripts.eb_bajnimen.on_damage
    tt.health_bar.offset = vec_2(-15, 145)
    tt.health_bar.type = HEALTH_BAR_SIZE_LARGE
    tt.info.enc_icon = 42
    tt.info.i18n_key = "EB_BAJNIMEN"
    tt.info.portrait = "kr3_portraits_sc_0076"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_bajnimen.update
    tt.motion.max_speed = 0.996 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.1336206896551724)
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].prefix = "eb_bajnimen"
    tt.sound_events.death = "ElvesBajNimenBossDeath"
    tt.ui.click_rect = r(-35, 0, 70, 130)
    tt.unit.can_explode = false
    tt.unit.hit_offset = vec_2(-17, 86)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(17, 75)
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_SKELETON, F_POLYMORPH)
    tt.melee.attacks[1].cooldown = 1.5
    tt.melee.attacks[1].damage_max = {150, 150, 250}
    tt.melee.attacks[1].damage_min = {120, 120, 200}
    tt.melee.attacks[1].hit_time = fts(20)
    tt.melee.attacks[1].sound = "ElvesBajNimenBossTail"
    tt.melee.attacks[1].sound_args = {
        delay = fts(5)
    }
    tt.melee.attacks[1].uninterruptible = true
    tt.ranged.attacks[1].bullet = "bolt_bajnimen"
    tt.ranged.attacks[1].cooldown = 1.5
    tt.ranged.attacks[1].shoot_time = fts(7)
    tt.ranged.attacks[1].max_range = 125
    tt.ranged.attacks[1].min_range = 20
    tt.ranged.attacks[1].bullet_start_offset = {vec_2(30, 135)}
    tt.timed_attacks.list[1] = E:clone_c("custom_attack")
    tt.timed_attacks.list[1].animations = {"shadowStorm_start", "shadowStorm_loop", "shadowStorm_end"}
    tt.timed_attacks.list[1].vis_bans = bor(F_ENEMY, F_BOSS)
    tt.timed_attacks.list[1].vis_flags = bor(F_RANGED)
    tt.timed_attacks.list[1].sound = "ElvesBajNimenBossShadowCast"
    tt.timed_attacks.list[1].spread = 5
    tt.timed_attacks.list[1].cooldown = 4
    tt.timed_attacks.list[1].max_range = 9e+99
    tt.timed_attacks.list[1].bullet = "meteor_bajnimen"
    tt.timed_attacks.list[2] = E:clone_c("custom_attack")
    tt.timed_attacks.list[2].animations = {"charge_start", "charge_loop", "charge_end"}
    tt.timed_attacks.list[2].current_step = 1
    tt.timed_attacks.list[2].active = false
    tt.timed_attacks.list[2].steps = {{}, {}, {}}
    tt.timed_attacks.list[2].steps[1].hp_threshold = 0.8
    tt.timed_attacks.list[2].steps[1].hp_heal = 30
    tt.timed_attacks.list[2].steps[2].hp_threshold = 0.5
    tt.timed_attacks.list[2].steps[2].hp_heal = 40
    tt.timed_attacks.list[2].steps[3].hp_threshold = 0.2
    tt.timed_attacks.list[2].steps[3].hp_heal = 50
    tt.timed_attacks.list[2].heal_every = fts(3)
    tt.timed_attacks.list[2].duration = 3
    tt.timed_attacks.list[2].sound = "ElvesBajNimenBossHeal"
    tt.timed_attacks.list[2].hit_offset = vec_2(0, 40)
    tt.timed_attacks.list[2].mod_offset = vec_2(0, 35)

    tt = RT("meteor_bajnimen", "arrow_hero_elves_archer_ultimate")
    tt.bullet.arrive_decal = "decal_bomb_crater"
    tt.bullet.hit_fx = "fx_meteor_bajnimen_explosion"
    tt.bullet.max_speed = 750
    tt.bullet.mod = nil
    tt.bullet.damage_bans = F_ENEMY
    tt.bullet.damage_type = DAMAGE_PHYSICAL
    tt.bullet.damage_max = {80, 80, 200}
    tt.bullet.damage_min = {80, 80, 120}
    tt.render.sprites[1].name = "bajnimen_boss_storm_meteor"
    tt.sound_events.insert = "ElvesBajNimenBossShadowTravel"

    tt = RT("fx_meteor_bajnimen_explosion", "fx")
    AC(tt, "sound_events")
    tt.render.sprites[1].name = "fx_meteor_bajnimen_explosion"
    tt.render.sprites[1].z = Z_OBJECTS
    tt.sound_events.insert = "ElvesBajNimenBossShadowImpact"
    tt = RT("bolt_bajnimen", "bolt_enemy")
    tt.bullet.damage_min = {72, 72, 72, 200}
    tt.bullet.damage_max = {96, 96, 96, 300}
    tt.bullet.hit_fx = "fx_bolt_bajnimen_hit"
    tt.bullet.max_speed = 360
    tt.render.sprites[1].prefix = "bolt_bajnimen"
    tt.sound_events.insert = "BoltSorcererSound"

    tt = RT("fx_bolt_bajnimen_hit", "fx")
    AC(tt, "sound_events")
    tt.sound_events.insert = "ElvesBajNimenBossRangedAttack"
    tt.render.sprites[1].name = "fx_bolt_bajnimen_hit"
    tt.render.sprites[1].anchor.y = 0.16666666666666666

    tt = RT("eb_balrog", "boss")
    AC(tt, "melee", "timed_attacks")
    tt.enemy.gold = 0
    tt.enemy.lives_cost = 20
    tt.enemy.melee_slot = vec_2(60, 0)
    tt.health.dead_lifetime = 100
    tt.health.hp_max = 11000
    tt.health.armor = 0.7
    tt.health_bar.offset = vec_2(0, 100)
    tt.health_bar.type = HEALTH_BAR_SIZE_MEDIUM_LARGE
    tt.info.enc_icon = 48
    tt.info.i18n_key = "EB_BALROG"
    tt.info.portrait = "kr3_portraits_sc_0083"
    tt.main_script.insert = scripts.enemy_basic.insert
    tt.main_script.update = scripts.eb_balrog.update
    tt.motion.max_speed = 0.664 * FPS
    tt.render.sprites[1].anchor = vec_2(0.5, 0.13)
    tt.render.sprites[1].angles = {}
    tt.render.sprites[1].angles.walk = {"walkingRightLeft", "walkingUp", "walkingDown"}
    tt.render.sprites[1].prefix = "eb_balrog"
    tt.sound_events.death = "ElvesBalrogDeath"
    tt.ui.click_rect = r(-35, 0, 70, 80)
    tt.unit.blood_color = BLOOD_ORANGE
    tt.unit.can_explode = false
    tt.unit.hit_offset = vec_2(0, 40)
    tt.unit.marker_offset = vec_2(0, 0)
    tt.unit.mod_offset = vec_2(0, 45)
    tt.unit.show_blood_pool = false
    tt.unit.size = UNIT_SIZE_LARGE
    tt.vis.bans = bor(F_SKELETON, F_POLYMORPH)
    tt.melee.attacks[1] = CC("area_attack")
    tt.melee.attacks[1].cooldown = 1.5
    tt.melee.attacks[1].damage_max = 250
    tt.melee.attacks[1].damage_min = 200
    tt.melee.attacks[1].damage_radius = 45
    tt.melee.attacks[1].damage_type = DAMAGE_PHYSICAL
    tt.melee.attacks[1].count = 10
    tt.melee.attacks[1].hit_time = fts(14)
    tt.melee.attacks[1].hit_offset = vec_2(60, -2)
    tt.melee.attacks[1].sound = "ElvesBalrogAttack"
    tt.melee.attacks[1].uninterruptible = true
    tt.timed_attacks.list[1] = CC("bullet_attack")
    tt.timed_attacks.list[1].bullet = "bullet_balrog"
    tt.timed_attacks.list[1].animation = "spit"
    tt.timed_attacks.list[1].cooldown = {10, 10, 10, 9}
    tt.timed_attacks.list[1].shoot_time = fts(9)
    tt.timed_attacks.list[1].max_range = 1e+99
    tt.timed_attacks.list[1].min_range = 0
    tt.timed_attacks.list[1].bullet_start_offset = {vec_2(23, 82)}
    tt.timed_attacks.list[1].sound = "ElvesBalrogSpit"
    tt.timed_attacks.list[1].vis_bans = bor(F_ENEMY, F_FLYING)
    tt.timed_attacks.list[1].vis_flag = F_RANGED

    tt = RT("eb_hee_haw", "decal_scripted")
    AC(tt, "taunts", "attacks")
    tt.main_script.update = scripts.eb_hee_haw.update
    tt.render.sprites[1].prefix = "eb_hee_haw_layer1"
    tt.render.sprites[1].anchor.y = 0
    tt.render.sprites[2] = CC("sprite")
    tt.render.sprites[2].anchor.y = 0
    tt.render.sprites[2].prefix = "eb_hee_haw_layer2"
    tt.taunts.delay_min = 15
    tt.taunts.delay_max = 20
    tt.taunts.duration = 3.7
    tt.taunts.sets = {
        welcome = {},
        prebattle = {},
        battle = {}
    }
    tt.taunts.sets.welcome.format = "ENDLESS_BOSS_GNOLL_TAUNT_WELCOME_%04d"
    tt.taunts.sets.welcome.start_idx = 1
    tt.taunts.sets.welcome.end_idx = 2
    tt.taunts.sets.prebattle.format = "ENDLESS_BOSS_GNOLL_TAUNT_PREBATTLE_%04d"
    tt.taunts.sets.prebattle.start_idx = 1
    tt.taunts.sets.prebattle.end_idx = 5
    tt.taunts.sets.battle.format = "ENDLESS_BOSS_GNOLL_TAUNT_GENERIC_%04d"
    tt.taunts.sets.battle.start_idx = 1
    tt.taunts.sets.battle.end_idx = 11
    tt.taunts.decal_name = "decal_endless_shoutbox"
    tt.taunts.offset = vec_2(0, 0)
    tt.taunts.pos = vec_2(919, 533)
    tt.attacks.list[1] = CC("custom_attack")
    tt.attacks.list[1].animation = "shout"
    tt.attacks.list[1].multishot_counts = {3, 4, 5}
    tt.attacks.list[1].munition_type = 3
    tt.attacks.list[1].sound = "EndlessHeeHawCall"
    tt.attacks.list[2] = CC("custom_attack")
    tt.attacks.list[2].animation = "shout"
    tt.attacks.list[2].multishot_counts = {3, 4, 5}
    tt.attacks.list[2].sound = "EndlessHeeHawCall"
    tt.attacks.list[3] = CC("bullet_attack")
    tt.attacks.list[3].shoot_time = fts(19)
    tt.attacks.list[3].bullet = "snare_hee_haw"
    tt.attacks.list[3].bullet_start_offset = vec_2(36, 160)

    tt = RT("eb_ainyl", "decal_scripted")
    AC(tt, "taunts", "attacks")
    tt.main_script.update = scripts.eb_ainyl.update
    tt.render.sprites[1].prefix = "eb_ainyl"
    tt.render.sprites[1].anchor.y = 0
    tt.taunts.delay_min = 15
    tt.taunts.delay_max = 20
    tt.taunts.duration = 3.7
    tt.taunts.sets = {
        welcome = {},
        prebattle = {},
        battle = {}
    }
    tt.taunts.sets.welcome.format = "ENDLESS_BOSS_TWILIGHT_TAUNT_WELCOME_%04d"
    tt.taunts.sets.welcome.start_idx = 1
    tt.taunts.sets.welcome.end_idx = 2
    tt.taunts.sets.prebattle.format = "ENDLESS_BOSS_TWILIGHT_TAUNT_PREBATTLE_%04d"
    tt.taunts.sets.prebattle.start_idx = 1
    tt.taunts.sets.prebattle.end_idx = 1
    tt.taunts.sets.battle.format = "ENDLESS_BOSS_TWILIGHT_TAUNT_GENERIC_%04d"
    tt.taunts.sets.battle.start_idx = 1
    tt.taunts.sets.battle.end_idx = 5
    tt.taunts.decal_name = "decal_endless_shoutbox"
    tt.taunts.offset = vec_2(0, 0)
    tt.taunts.pos = vec_2(610, 630)
    tt.attacks.list[1] = CC("mod_attack")
    tt.attacks.list[1].animation = "teleport"
    tt.attacks.list[1].shoot_time = fts(53)
    tt.attacks.list[1].vis_bans = bor(F_BOSS)
    tt.attacks.list[1].vis_flags = bor(F_RANGED, F_TELEPORT)
    tt.attacks.list[1].nodes_limit = 60
    tt.attacks.list[1].sound = "EndlessAinylTeleport"
    tt.attacks.list[1].mod = "mod_teleport_ainyl"
    tt.attacks.list[2] = CC("mod_attack")
    tt.attacks.list[2].animation = "block"
    tt.attacks.list[2].shoot_time = fts(20)
    tt.attacks.list[2].max_range = 1e+99
    tt.attacks.list[2].min_range = 0
    tt.attacks.list[2].mod = "mod_block_tower_ainyl"
    tt.attacks.list[2].sound = "EndlessAinylDisable"
    tt.attacks.list[3] = CC("mod_attack")
    tt.attacks.list[3].animation = "shield"
    tt.attacks.list[3].shoot_time = fts(21)
    tt.attacks.list[3].mod = "mod_shield_ainyl"
    tt.attacks.list[3].vis_bans = bor(F_BOSS, F_FLYING)
    tt.attacks.list[3].vis_flags = bor(F_RANGED)
    tt.attacks.list[3].sound = "EndlessAinylShield"
end
return boss
